import{z as A,A as P,r as d,B as T,D as b,R as V,S as i,V as n,T as l,al as w,X as p,an as f,ao as S,Y as u,a0 as B,ap as N,Z as _,$ as h,a3 as $,F as c}from"./index.168e4218.js";import{Q as D}from"./QForm.5b8ff544.js";import{Q as U,a as F}from"./QTable.54c001c1.js";const L={class:"q-mb-lg"},E={class:"text-h6"},R={class:"row q-col-gutter-md q-px-md"},z={class:"col-12 col-sm-6"},G={class:"col-12 col-sm-6"},M={class:"row items-center q-gutter-x-sm"},j=A({__name:"ShortsPageCurd",setup(O){const s=P(),g=d([]),v=d(!1),r=d(!1),a=d({title:"",description:"",videoUrl:"",videoSource:"normal",status:"active",location:{type:"Point",coordinates:[0,0]}}),C=[{name:"title",label:"Title",field:"title",sortable:!0},{name:"description",label:"Description",field:"description"},{name:"videoUrl",label:"Video URL",field:"videoUrl"},{name:"info",label:"Status & Source",field:o=>({status:o.status,videoSource:o.videoSource}),sortable:!0},{name:"location",label:"Location",field:o=>{var t;return((t=o.location)==null?void 0:t.coordinates)&&Array.isArray(o.location.coordinates)?o.location.coordinates.join(", "):"N/A"},sortable:!0},{name:"actions",label:"Actions",field:"actions"}],m=async()=>{v.value=!0;try{const o=await c.get("/incidents/shorts");g.value=o.data}catch{s.notify({color:"negative",message:"Failed to fetch incidents",position:"top-right"})}finally{v.value=!1}},Q=()=>new Promise((o,t)=>{if(!navigator.geolocation){t(new Error("Geolocation is not supported by your browser"));return}navigator.geolocation.getCurrentPosition(e=>{o([e.coords.longitude,e.coords.latitude])},e=>{t(e)})}),k=async()=>{try{try{const o=await Q();a.value.location={type:"Point",coordinates:o}}catch{s.notify({color:"warning",message:"Could not get location. Using default coordinates.",timeout:2e3,position:"top-right"})}r.value?(await c.put(`/incidents/shorts/${a.value.id}`,a.value),s.notify({color:"black",message:"Incident updated successfully with location",position:"top-right"})):(await c.post("/incidents/shorts",a.value),s.notify({color:"black",message:"Incident created successfully with location",position:"top-right"})),y(),await m()}catch{s.notify({color:"negative",message:"Operation failed",position:"top-right"})}},q=o=>{a.value={id:o.id,title:o.title,description:o.description,videoUrl:o.videoUrl,videoSource:o.videoSource,status:o.status||"active",location:o.location||{type:"Point",coordinates:[0,0]}},r.value=!0},I=async o=>{try{await c.delete(`/incidents/shorts/${o}`),await m(),s.notify({color:"black",message:"Incident deleted successfully",position:"top-right"})}catch{s.notify({color:"negative",message:"Failed to delete incident",position:"top-right"})}},y=()=>{a.value={title:"",description:"",videoUrl:"",videoSource:"normal",status:"active",location:{type:"Point",coordinates:[0,0]}},r.value=!1};return T(()=>{m()}),(o,t)=>(b(),V($,{padding:""},{default:i(()=>[n("div",L,[l(N,null,{default:i(()=>[l(w,null,{default:i(()=>[n("div",E,p(r.value?"Edit Incident":"Add New Incident"),1)]),_:1}),l(w,null,{default:i(()=>[l(D,{onSubmit:k,class:"q-gutter-md"},{default:i(()=>[l(f,{modelValue:a.value.title,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.title=e),label:"Title",rules:[e=>!!e||"Title is required"]},null,8,["modelValue","rules"]),l(f,{modelValue:a.value.description,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.description=e),type:"textarea",label:"Description",rules:[e=>!!e||"Description is required"]},null,8,["modelValue","rules"]),l(f,{modelValue:a.value.videoUrl,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.videoUrl=e),label:"Video URL",rules:[e=>!!e||"Video URL is required"]},null,8,["modelValue","rules"]),n("div",R,[n("div",z,[l(S,{modelValue:a.value.videoSource,"onUpdate:modelValue":t[3]||(t[3]=e=>a.value.videoSource=e),options:["normal","youtube"],label:"Video Source",rules:[e=>!!e||"Video source is required"]},null,8,["modelValue","rules"])]),n("div",G,[l(S,{modelValue:a.value.status,"onUpdate:modelValue":t[4]||(t[4]=e=>a.value.status=e),options:["Active","InActive"],label:"Status",rules:[e=>!!e||"Status is required"]},null,8,["modelValue","rules"])])]),n("div",null,[l(u,{type:"submit",color:"primary",label:r.value?"Update":"Submit"},null,8,["label"]),r.value?(b(),V(u,{key:0,flat:"",color:"red",label:"Cancel",class:"q-ml-sm",onClick:y})):B("",!0)])]),_:1})]),_:1})]),_:1})]),l(F,{rows:g.value,columns:C,"row-key":"id",loading:v.value},{"body-cell-actions":i(e=>[l(U,{props:e},{default:i(()=>[l(u,{flat:"",round:"",color:"primary",icon:"edit",onClick:x=>q(e.row)},null,8,["onClick"]),l(u,{flat:"",round:"",color:"negative",icon:"delete",onClick:x=>I(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-info":i(e=>[l(U,{props:e},{default:i(()=>[n("div",M,[l(_,{color:e.row.status==="active"?"positive":"negative"},{default:i(()=>[h(p(e.row.status),1)]),_:2},1032,["color"]),l(_,{color:e.row.videoSource==="youtube"?"red":"blue"},{default:i(()=>[h(p(e.row.videoSource),1)]),_:2},1032,["color"])])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}))}});export{j as default};
