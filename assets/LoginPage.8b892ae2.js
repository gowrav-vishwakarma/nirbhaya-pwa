import{y as W,_ as G,G as M,z as H,I as K,A as X,u as Y,H as Z,r as x,e as P,B as J,F as C,bZ as T,v as ee,D as g,R as h,S as r,V as l,T as s,ap as te,aN as oe,al as k,X as b,U as o,aG as se,$ as ae,an as A,W as U,a0 as V,E as q,aK as re,Y as S,a3 as le}from"./index.168e4218.js";import{Q as ne}from"./QForm.5b8ff544.js";import{u as ie}from"./use-form.7267c9e0.js";import{_ as ue}from"./LanguageSelector.45b6e4ae.js";import{i as me,a as pe,v as de}from"./package.a4721cbb.js";const ce=W("Device",{web:()=>G(()=>import("./web.ddfdf04c.js"),["assets/web.ddfdf04c.js","assets/index.168e4218.js","assets/index.85b279a3.css"]).then(I=>new I.DeviceWeb)});const fe={class:"login-card-main"},ve={class:"flex justify-center"},ge={class:"text-h5 text-weight-bold text-primary",style:{margin:"0px",padding:"0px","margin-top":"-10px"}},be={key:1,class:"q-ma-none q-py-sm",style:{"text-align":"start","margin-top":"-20px"}},ye={style:{"font-size":"9px","font-weight":"700",color:"dimgrey"}},_e={key:2,class:"text-center",style:{"margin-top":"-10px"}},xe={style:{"font-size":"13px"}},he={class:"text-center",style:{"margin-top":"-10px"}},we={style:{"font-size":"12px"}},Ne={class:"text-center text-subtitle1 versiontextcolor text-weight-thin",style:{"font-weight":"600"}},Pe={style:{"font-size":"13px"}},Te=H({__name:"LoginPage",setup(I){const{t:a}=K(),p=X(),m=Y(),n=Z(),i=x(!1),w=x(!1),f=x(0),v=x(null),E=P(()=>p.platform.is.ios?me:p.platform.is.android?pe:de),$=P(()=>p.platform.is.ios&&!p.platform.is.safari&&!p.platform.is.nativeMobile);J(()=>{const e=n.currentRoute.value.params.referrer;console.log("referrer",e),e&&m.setReferrer(e.toString()),m.isLoggedIn&&(m.userName?m.user.defaultApp==="community"?n.push("comunity-post"):m.user.defaultApp==="news"?n.push("/news"):n.push("/sos"):n.push("/profile"))});const{values:u,errors:y,validateAndSubmit:z,updateUrl:L,callbacks:N}=ie(C,"auth/sendOtp",{mobileNumber:"",otp:"",deviceId:"",platform:p.platform.is}),d=x(!1),B=async()=>{d.value=!0;try{const{identifier:e}=await ce.getId();u.value.deviceId=e,await z(!1)}catch(e){console.error("Submit error:",e)}};N.beforeSubmit=async e=>{const t=e,c={};if(i.value?(!t.otp||t.otp.length!==4||!/^\d+$/.test(t.otp))&&(c.otp=["Please enter a valid 4-digit OTP"]):(!t.mobileNumber||t.mobileNumber.length!==10||!/^\d+$/.test(t.mobileNumber))&&(c.mobileNumber=["Please enter a valid 10-digit mobile number"]),Object.keys(c).length>0)throw y.value=c,new Error("Validation failed");return e},N.onSuccess=async e=>{i.value?(m.setUser(e),await m.sendTokenIfAvailable(),e.name?m.user.defaultApp==="community"?n.push("comunity-post"):m.user.defaultApp==="news"?n.push("/news"):n.push("/sos"):n.push("/profile")):(i.value=!0,L("/auth/login"),O()),d.value=!1},N.onError=async e=>{console.log("Error in login page",e),d.value=!1,T.create({type:"negative",message:i.value?"Login failed. Please check your OTP and try again.":"Failed to send OTP. Please try again.",position:"top-right"})};const O=()=>{f.value=30,v.value=window.setInterval(()=>{f.value>0?f.value--:v.value&&(clearInterval(v.value),v.value=null)},1e3)},F=async()=>{d.value=!0;try{await C.post("auth/sendOtp",{mobileNumber:u.value.mobileNumber,platform:p.platform.is}),T.create({type:"positive",message:"OTP resent successfully",position:"top-right"}),O()}catch(e){console.error("Error resending OTP:",e),T.create({type:"negative",message:"Failed to resend OTP. Please try again.",position:"top-right"})}finally{d.value=!1}},R=()=>{n.push("/about-us")},D=()=>{window.open("https://sosbharat.com/tnc.html","_blank")},j=P(()=>{var e,t;return i.value?((t=u.value.otp)==null?void 0:t.length)===4&&/^\d+$/.test(u.value.otp):w.value&&((e=u.value.mobileNumber)==null?void 0:e.length)===10&&/^\d+$/.test(u.value.mobileNumber)});return ee(()=>{v.value&&clearInterval(v.value)}),(e,t)=>(g(),h(le,{class:"flex flex-center"},{default:r(()=>[l("div",fe,[s(te,{class:"login-card"},{default:r(()=>[l("div",ve,[s(oe,{src:"/sosLogo_512_512.png",style:{height:"100px",width:"100px","margin-top":"30px"}})]),t[3]||(t[3]=l("div",{class:"text-subtitle1 text-weight-medium text-grey-7 q-mb-lg q-mt-md text-center"}," Community SOS ",-1)),s(k,{class:"text-center",style:{margin:"0px",padding:"0px"}},{default:r(()=>[l("div",ge,b(o(a)("common.login")),1),s(ue,{class:"q-mt-md q-px-md"})]),_:1}),$.value?(g(),h(k,{key:0},{default:r(()=>[s(se,{class:"bg-negative text-white",rounded:""},{default:r(()=>[ae(b(o(a)("common.iosNotSafariWarning")),1)]),_:1})]),_:1})):(g(),h(k,{key:1,class:"text-center"},{default:r(()=>[s(ne,{onSubmit:B,class:""},{default:r(()=>{var c,Q;return[s(A,{filled:"",modelValue:o(u).mobileNumber,"onUpdate:modelValue":t[0]||(t[0]=_=>o(u).mobileNumber=_),label:o(a)("common.mobileNumber"),error:!!o(y).mobileNumber,"error-message":(c=o(y).mobileNumber)==null?void 0:c.join("; "),mask:"##########",disable:i.value,type:"tel"},{prepend:r(()=>[s(U,{name:o(a)("common.icons.phone"),color:"primary"},null,8,["name"])]),_:1},8,["modelValue","label","error","error-message","disable"]),i.value?(g(),h(A,{key:0,filled:"",modelValue:o(u).otp,"onUpdate:modelValue":t[1]||(t[1]=_=>o(u).otp=_),label:o(a)("common.enterOTP"),error:!!o(y).otp,"error-message":(Q=o(y).otp)==null?void 0:Q.join("; "),mask:"####",type:"tel"},{prepend:r(()=>[s(U,{name:o(a)("common.icons.lock"),color:"primary"},null,8,["name"])]),_:1},8,["modelValue","label","error","error-message"])):V("",!0),i.value?V("",!0):(g(),q("div",be,[s(re,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=_=>w.value=_),color:"primary"},{default:r(()=>[l("span",ye,b(o(a)("common.acceptTerms")),1)]),_:1},8,["modelValue"]),l("span",{style:{"font-size":"10px",margin:"3px",cursor:"pointer"},onClick:D,class:"text-capitalize text-primary"}," Read ")])),s(S,{label:i.value?o(a)("common.login"):o(a)("common.sendOTP"),type:"submit",color:"primary",class:"full-width q-py-sm",loading:d.value,disable:!j.value},null,8,["label","loading","disable"])]}),_:1})]),_:1})),i.value?(g(),q("div",_e,[s(S,{flat:"",color:"primary",onClick:F,disable:d.value||f.value>0},{default:r(()=>[l("span",xe,b(f.value>0?`${o(a)("common.resendOTP")} (${f.value}s)`:o(a)("common.resendOTP")),1)]),_:1},8,["disable"])])):V("",!0),l("div",he,[s(S,{flat:"",onClick:R,class:"q-mb-md"},{default:r(()=>[l("span",we,b(o(a)("common.aboutUs")),1)]),_:1})])]),_:1}),l("div",Ne,[t[4]||(t[4]=l("span",{style:{"font-size":"13px"}},"App version : ",-1)),l("span",Pe,b(E.value),1)])])]),_:1}))}});var Qe=M(Te,[["__scopeId","data-v-6ef138e0"]]);export{Qe as default};
