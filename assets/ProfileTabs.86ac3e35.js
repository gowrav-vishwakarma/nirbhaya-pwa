import{a4 as ze,d as He,a5 as Fe,a6 as je,a7 as Ge,a8 as We,a9 as Ye,r as I,aa as Ke,ab as Xe,e as G,w as ve,ac as Je,o as Ze,h as oe,k as eo,ad as oo,ae as Ce,af as ie,ag as se,ah as to,f as ao,ai as ae,aj as Z,W as ue,ak as so,z as ne,I as ge,A as le,u as ce,B as re,F as K,D as C,R as M,S as n,V as o,T as e,al as J,am as no,X as $,an as te,U as i,Y as D,ao as be,ap as ee,a3 as Ee,G as de,M as lo,aq as he,ar as $e,$ as Y,as as ye,a0 as j,E as O,at as we,au as Se,av as Be,N as Re,aw as _e,ax as Ue,ay as Oe,H as Te,az as io,aA as ro,aB as uo,aC as co,v as mo,aD as po,C as vo,aE as go,aF as fo,aG as yo,aH as bo,aI as Me,aJ as qe,aK as ho,aL as _o,aM as Ne,aN as Pe,t as Co,aO as $o,aP as wo,aQ as So}from"./index.168e4218.js";import{Q as ko,a as xo,S as Vo}from"./SearchCity.8f76d389.js";import{Q as qo}from"./QForm.5b8ff544.js";import{u as De}from"./use-form.7267c9e0.js";import{_ as Io}from"./LanguageSelector.45b6e4ae.js";import{i as Ao,a as No,v as Po}from"./package.a4721cbb.js";import{Q as Lo}from"./QFile.d1cd6fbd.js";import{u as Eo}from"./use-user-form.aba52028.js";const me=ze({}),Uo=Object.keys(Fe);var pe=He({name:"QExpansionItem",props:{...Fe,...je,...Ge,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:{},headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...We,"click","afterShow","afterHide"],setup(y,{slots:F,emit:p}){const{proxy:{$q:x}}=eo(),c=Ye(y,x),P=I(y.modelValue!==null?y.modelValue:y.defaultOpened),d=I(null),r=Ke(),{show:A,hide:U,toggle:l}=Xe({showing:P});let B,a;const V=G(()=>`q-expansion-item q-item-type q-expansion-item--${P.value===!0?"expanded":"collapsed"} q-expansion-item--${y.popup===!0?"popup":"standard"}`),R=G(()=>{if(y.contentInsetLevel===void 0)return null;const q=x.lang.rtl===!0?"Right":"Left";return{["padding"+q]:y.contentInsetLevel*56+"px"}}),z=G(()=>y.disable!==!0&&(y.href!==void 0||y.to!==void 0&&y.to!==null&&y.to!=="")),H=G(()=>{const q={};return Uo.forEach(S=>{q[S]=y[S]}),q}),T=G(()=>z.value===!0||y.expandIconToggle!==!0),X=G(()=>y.expandedIcon!==void 0&&P.value===!0?y.expandedIcon:y.expandIcon||x.iconSet.expansionItem[y.denseToggle===!0?"denseIcon":"icon"]),_=G(()=>y.disable!==!0&&(z.value===!0||y.expandIconToggle===!0)),s=G(()=>({expanded:P.value===!0,detailsId:r.value,toggle:l,show:A,hide:U})),b=G(()=>{const q=y.toggleAriaLabel!==void 0?y.toggleAriaLabel:x.lang.label[P.value===!0?"collapse":"expand"](y.label);return{role:"button","aria-expanded":P.value===!0?"true":"false","aria-controls":r.value,"aria-label":q}});ve(()=>y.group,q=>{a!==void 0&&a(),q!==void 0&&m()});function h(q){z.value!==!0&&l(q),p("click",q)}function w(q){q.keyCode===13&&u(q,!0)}function u(q,S){S!==!0&&d.value!==null&&d.value.focus(),l(q),so(q)}function k(){p("afterShow")}function v(){p("afterHide")}function m(){B===void 0&&(B=Je()),P.value===!0&&(me[y.group]=B);const q=ve(P,N=>{N===!0?me[y.group]=B:me[y.group]===B&&delete me[y.group]}),S=ve(()=>me[y.group],(N,Q)=>{Q===B&&N!==void 0&&N!==B&&U()});a=()=>{q(),S(),me[y.group]===B&&delete me[y.group],a=void 0}}function t(){const q={class:[`q-focusable relative-position cursor-pointer${y.denseToggle===!0&&y.switchToggleSide===!0?" items-end":""}`,y.expandIconClass],side:y.switchToggleSide!==!0,avatar:y.switchToggleSide},S=[oe(ue,{class:"q-expansion-item__toggle-icon"+(y.expandedIcon===void 0&&P.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:X.value})];return _.value===!0&&(Object.assign(q,{tabindex:0,...b.value,onClick:u,onKeyup:w}),S.unshift(oe("div",{ref:d,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),oe(Z,q,()=>S)}function g(){let q;return F.header!==void 0?q=[].concat(F.header(s.value)):(q=[oe(Z,()=>[oe(ae,{lines:y.labelLines},()=>y.label||""),y.caption?oe(ae,{lines:y.captionLines,caption:!0},()=>y.caption):null])],y.icon&&q[y.switchToggleSide===!0?"push":"unshift"](oe(Z,{side:y.switchToggleSide===!0,avatar:y.switchToggleSide!==!0},()=>oe(ue,{name:y.icon})))),y.disable!==!0&&y.hideExpandIcon!==!0&&q[y.switchToggleSide===!0?"unshift":"push"](t()),q}function f(){const q={ref:"item",style:y.headerStyle,class:y.headerClass,dark:c.value,disable:y.disable,dense:y.dense,insetLevel:y.headerInsetLevel};return T.value===!0&&(q.clickable=!0,q.onClick=h,Object.assign(q,z.value===!0?H.value:b.value)),oe(ie,q,g)}function E(){return se(oe("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:R.value,id:r.value},ao(F.default)),[[to,P.value]])}function W(){const q=[f(),oe(oo,{duration:y.duration,onShow:k,onHide:v},E)];return y.expandSeparator===!0&&q.push(oe(Ce,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:c.value}),oe(Ce,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:c.value})),q}return y.group!==void 0&&m(),Ze(()=>{a!==void 0&&a()}),()=>oe("div",{class:V.value},[oe("div",{class:"q-expansion-item__container relative-position"},W())])}});const Oo={class:"profile-content"},Do={class:"row q-col-gutter-sm"},Fo={class:"col-12 col-sm-6 q-py-none custom-input"},Bo={class:"col-12 col-sm-6 q-py-none custom-input"},Ro={class:"col-12 col-sm-6 q-py-none custom-input"},To={class:"row items-center justify-end"},Mo={class:"col-12 col-sm-6 q-py-none custom-input"},Qo={class:"col-12 col-sm-6 q-py-none custom-input"},zo={class:"col-12 col-sm-6 q-py-none custom-input"},Ho={class:"col-12 q-py-none custom-input"},jo={class:"col-12 q-py-none custom-input"},Go={class:"col-12 q-py-none custom-input"},Wo={class:"row q-col-gutter-md q-mt-none",style:{"margin-top":"-15px"}},Yo={class:"col-12"},Ko=ne({__name:"ProfilePage",props:{reloadComponents:{type:Function}},emits:["reloadComponents"],setup(y,{emit:F}){const{t:p}=ge(),x=le(),c=ce(),P=y,d=F,r=["Girl/Woman (18-35)","Woman (35+)","Senior Woman (60+)","Boy/Man (18-35)","Man (35+)","Senior Man (60+)","Child (Under 18)","Prefer not to say"],A=["Andhra Pradesh","Arunachal Pradesh","Telangana","Assam","Bihar","Uttar Pradesh","Gujarat","Goa","Haryana","Himachal Pradesh","Jammu and Kashmir","Madhya Pradesh","Karnataka","Kerala","Maharashtra","Chattisgarh","Delhi","Daman and Diu","Dadra and Nagar Hav.","Manipur","Megalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Tripura","Jharkhand","Uttarakhand","BIJAPUR(KAR)","Lakshadweep","Chandigarh","Pondicherry","Andaman and Nico.In.","West Bengal"],U=I([...A]),l=[{label:p("common.student"),value:"student"},{label:p("common.freelancer"),value:"freelancer"},{label:p("common.onlineSeller"),value:"onlineSeller"},{label:p("common.handicraftMaker"),value:"handicraftMaker"},{label:p("common.tailor"),value:"tailor"},{label:p("common.beautician"),value:"beautician"},{label:p("common.foodSeller"),value:"foodSeller"},{label:p("common.artsMediaDesigner"),value:"artsMediaDesigner"},{label:p("common.skilledTradesWorker"),value:"skilledTradesWorker"},{label:p("common.shopOwner"),value:"shopOwner"},{label:p("common.techITProfessional"),value:"techITProfessional"},{label:p("common.healthcareMedicalWorker"),value:"healthcareMedicalWorker"},{label:p("common.socialWorker"),value:"socialWorker"},{label:p("common.privateSectorEmployee"),value:"privateSectorEmployee"},{label:p("common.governmentEmployee"),value:"governmentEmployee"},{label:p("common.businessOwner"),value:"businessOwner"},{label:p("common.housewife"),value:"housewife"},{label:p("common.retired"),value:"retired"},{label:p("common.unemployed"),value:"unemployed"},{label:p("common.other"),value:"other"}],B=G(()=>{const t=[{label:p("common.sos"),value:"sos"},{label:p("common.news"),value:"news"},{label:p("common.community"),value:"community"}];return{}.ENABLE_ASTRO_APP==="true"&&t.push({label:p("common.astroai"),value:"astroai"}),t}),{values:a,errors:V,isLoading:R,validateAndSubmit:z,callbacks:H}=De(K,"user/user-profile-update",{name:"",phoneNumber:"",city:null,state:"",dob:"",userType:"",profession:"",pincode:"",emergencyContacts:[],startAudioVideoRecordOnSos:!1,streamAudioVideoOnSos:!1,broadcastAudioOnSos:!1,referredBy:"",defaultApp:"sos"});H.beforeSubmit=t=>{console.log("data before processing...",t);const g={...t,dob:t.dob||"",state:t.state||"",pincode:t.pincode||"",referredBy:V.value.referredBy?"":t.referredBy};if(t.city&&typeof t.city=="object"){const f=t.city;g.state=f.statename,g.pincode=f.pincode,g.city=f.officename}return console.log("data after processing...",g),g};const T=async()=>{const t=c.user;if(a.value.state=t.state||"",t.city&&t.state&&t.pincode){const g={officename:t.city,statename:t.state,pincode:t.pincode};a.value.city=g}Object.assign(a.value,{...t,city:a.value.city,name:t.name||"",phoneNumber:t.phoneNumber||"",dob:t.dob||"",userType:t.userType||"",profession:t.profession||"",emergencyContacts:t.emergencyContacts||[],startAudioVideoRecordOnSos:t.startAudioVideoRecordOnSos||!1,streamAudioVideoOnSos:t.streamAudioVideoOnSos||!1,broadcastAudioOnSos:t.broadcastAudioOnSos||!1,referredBy:t.referredBy||"",defaultApp:t.defaultApp||"sos"}),b.value=a.value.referredBy;try{const f=(await K.get("/user/emergency-contacts-status")).data;a.value.emergencyContacts=a.value.emergencyContacts.map(E=>{const W=f.find(q=>q.contactPhone===E.contactPhone);return{...E,consentGiven:W?W.consentGiven:!1}})}catch(g){console.error("Error fetching emergency contacts status:",g)}};re(()=>{T()});const X=G(()=>a.value.emergencyContacts.length>0),_=G(()=>a.value.referredBy&&V.value.referredBy?!1:!!a.value.name&&!!a.value.dob&&!!a.value.state&&!!a.value.city&&(X.value||a.value.emergencyContacts.length===0)&&a.value.emergencyContacts.every(t=>t.contactName&&t.contactPhone)&&!V.value.name&&!V.value.dob&&!V.value.state&&!V.value.city&&!Object.keys(V.value).some(t=>t.startsWith("emergencyContact"))),s=async()=>{_.value||a.value.emergencyContacts.length===0?z(!1):x.notify({color:"negative",message:p("common.pleaseFixErrors"),icon:"error",position:"top-right"})};H.onSuccess=t=>{var f;const g={...t.user,dob:a.value.dob,state:a.value.state,pincode:a.value.pincode,profession:a.value.profession};c.updateUser(g),T(),x.notify({color:"black",message:p("common.profileUpdateSuccess"),icon:"check",position:"top-right"}),(f=P.reloadComponents)==null||f.call(P),d("reloadComponents")},H.onError=async t=>{console.error("Error updating profile",t),x.notify({color:"negative",message:p("common.profileUpdateError"),icon:"error",position:"top-right"})};const b=I(""),h=t=>{t?(a.value.state=t.statename,a.value.pincode=t.pincode,a.value.city=t,delete V.value.city):(a.value.city=null,a.value.pincode="",V.value.city=["City Required"])},w=t=>{t?(a.value.state=t,a.value.city=null,a.value.pincode="",delete V.value.state,V.value.city=["City Required"],lo(()=>{a.value.city=null})):(a.value.state="",a.value.city=null,a.value.pincode="",V.value.state=["State Required"],V.value.city=["City Required"])},u=(t,g)=>{if(t===""){g(()=>{U.value=A});return}g(()=>{const f=t.toLowerCase();U.value=A.filter(E=>E.toLowerCase().indexOf(f)>-1)})};ve(()=>a.value.referredBy,async t=>{if(!t){delete V.value.referredBy;return}if(t!==b.value)try{(await K.get(`/user/validate-referral/${t}`)).data.exists?(delete V.value.referredBy,b.value=t):V.value.referredBy=[p("referralIdNotFound")]}catch(g){console.error("Error validating referral ID:",g),V.value.referredBy=[p("referralIdValidationFailed")]}},{immediate:!0});const k=G(()=>!!c.user.referredBy),v=G(()=>{const t=new Date;t.setFullYear(t.getFullYear()-150);const g=t.getFullYear(),f=String(t.getMonth()+1).padStart(2,"0");return`${g}/${f}`}),m=G(()=>{const t=new Date;t.setFullYear(t.getFullYear()-13);const g=t.getFullYear(),f=String(t.getMonth()+1).padStart(2,"0");return`${g}/${f}`});return(t,g)=>(C(),M(Ee,{class:"profile-page"},{default:n(()=>[o("div",Oo,[e(ee,{flat:"",class:"profile-card"},{default:n(()=>[e(J,null,{default:n(()=>[e(Io,{class:"q-mb-lg"}),e(qo,{onSubmit:no(s,["prevent"])},{default:n(()=>{var f,E,W,q,S,N,Q;return[o("div",Do,[o("div",Fo,[o("label",null,$(t.$t("common.name")),1),e(te,{modelValue:i(a).name,"onUpdate:modelValue":g[0]||(g[0]=L=>i(a).name=L),error:!!i(V).name,"error-message":(f=i(V).name)==null?void 0:f.join("; "),rules:[L=>!!L||t.$t("common.nameRequired")],filled:"",class:"custom-radius","bg-color":"pink-1",dense:"","hide-bottom-space":""},null,8,["modelValue","error","error-message","rules"])]),o("div",Bo,[o("label",null,$(t.$t("common.mobileNumber")),1),e(te,{modelValue:i(a).phoneNumber,"onUpdate:modelValue":g[1]||(g[1]=L=>i(a).phoneNumber=L),filled:"",class:"custom-radius","bg-color":"pink-1",dense:"",disable:"",readonly:"","hide-bottom-space":""},null,8,["modelValue"])]),o("div",Ro,[o("label",null,$(t.$t("common.dob")),1),e(te,{filled:"",modelValue:i(a).dob,"onUpdate:modelValue":g[3]||(g[3]=L=>i(a).dob=L),mask:"date",error:!!i(V).dob,"error-message":(E=i(V).dob)==null?void 0:E.join("; "),class:"custom-radius","bg-color":"pink-1",dense:"","hide-bottom-space":"",rules:[L=>!!L||"Date of birth is required"],"fill-mask":!0,"input-class":"text-left"},{append:n(()=>[e(ue,{name:"event",class:"cursor-pointer"}),e(ko,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[e(xo,{modelValue:i(a).dob,"onUpdate:modelValue":g[2]||(g[2]=L=>i(a).dob=L),"navigation-min-year-month":v.value,"navigation-max-year-month":m.value,"default-year-month":m.value},{default:n(()=>[o("div",To,[se(e(D,{label:"ok",color:"primary",flat:""},null,512),[[he]])])]),_:1},8,["modelValue","navigation-min-year-month","navigation-max-year-month","default-year-month"])]),_:1})]),_:1},8,["modelValue","error","error-message","rules"])]),o("div",Mo,[o("label",null,$(t.$t("common.state")),1),e(be,{modelValue:i(a).state,"onUpdate:modelValue":[g[4]||(g[4]=L=>i(a).state=L),w],options:U.value,filled:"",class:"custom-radius","bg-color":"pink-1",dense:"",clearable:"","use-input":"","input-debounce":"0",onFilter:u,error:!!i(V).state,"error-message":(W=i(V).state)==null?void 0:W.join("; "),"hide-bottom-space":""},null,8,["modelValue","options","error","error-message"])]),o("div",Qo,[o("label",null,$(t.$t("common.city")),1),(C(),M(Vo,{modelValue:i(a).city,"onUpdate:modelValue":[g[5]||(g[5]=L=>i(a).city=L),h],error:(q=i(V).city)==null?void 0:q.join("; "),"selected-state":i(a).state||"",disabled:!i(a).state,key:i(a).state},null,8,["modelValue","error","selected-state","disabled"]))]),o("div",zo,[o("label",null,$(t.$t("common.userType")),1),e(be,{modelValue:i(a).userType,"onUpdate:modelValue":g[6]||(g[6]=L=>i(a).userType=L),options:r,filled:"",class:"custom-radius","bg-color":"pink-1",dense:"",error:!!i(V).userType,"error-message":(S=i(V).userType)==null?void 0:S.join("; "),"hide-bottom-space":""},null,8,["modelValue","error","error-message"])]),o("div",Ho,[o("label",null,$(t.$t("common.profession")),1),e(be,{modelValue:i(a).profession,"onUpdate:modelValue":g[7]||(g[7]=L=>i(a).profession=L),options:l,filled:"",class:"custom-radius","bg-color":"pink-1",dense:"",error:!!i(V).profession,"error-message":(N=i(V).profession)==null?void 0:N.join("; "),"map-options":"","emit-value":"","option-value":"value","option-label":"label","hide-bottom-space":""},null,8,["modelValue","error","error-message"])]),o("div",jo,[o("label",null,$(t.$t("common.referredBy")),1),e(te,{modelValue:i(a).referredBy,"onUpdate:modelValue":g[8]||(g[8]=L=>i(a).referredBy=L),filled:"",class:"custom-radius","bg-color":"pink-1",dense:"",error:!!i(V).referredBy,"error-message":(Q=i(V).referredBy)==null?void 0:Q.join("; "),disable:k.value,"hide-bottom-space":""},null,8,["modelValue","error","error-message","disable"])]),o("div",Go,[o("label",null,$(t.$t("common.defaultApp")),1),e(be,{modelValue:i(a).defaultApp,"onUpdate:modelValue":g[9]||(g[9]=L=>i(a).defaultApp=L),options:B.value,filled:"",class:"custom-radius","bg-color":"pink-1",dense:"","map-options":"","emit-value":"","option-value":"value","option-label":"label","hide-bottom-space":""},null,8,["modelValue","options"])])]),o("div",Wo,[o("div",Yo,[e(D,{type:"submit",loading:i(R),color:"primary",class:"full-width next-button q-mt-xs",disable:!_.value,"no-caps":"",style:{"border-radius":"10px !important",height:"40px"}},{default:n(()=>[o("b",null,$(t.$t("common.saveChanges")),1)]),_:1},8,["loading","disable"])])])]}),_:1})]),_:1})]),_:1})])]),_:1}))}});var Xo=de(Ko,[["__scopeId","data-v-946918de"]]);const Jo={class:"volunteering-content"},Zo={class:"text-h6 q-mb-sm q-px-md q-mt-md q-ma-none"},et={class:"q-px-md q-ma-none q-mb-sm"},ot={class:"text-subtitle1 text-weight-bold q-mb-sm"},tt={class:"scrollable-inputs q-px-md"},at={key:1,class:"input-fields"},st={class:"custom-input"},nt={class:"custom-input"},lt={key:0,class:"text-caption q-mt-sm"},it={class:"row q-col-gutter-sm"},rt={class:"col-6"},ut={class:"col-6"},ct={key:3,class:"contact-cards q-mt-md"},dt={class:"col-auto"},mt={class:"col q-pl-sm"},pt={class:"text-subtitle2"},vt={key:0,class:"text-caption"},gt={class:"col-auto"},ft={class:"text-center"},yt={key:4,class:"text-negative q-mt-sm"},bt=ne({__name:"VolunteeringPage",props:{reloadComponents:{type:Function}},emits:["reloadComponents"],setup(y,{expose:F,emit:p}){const{t:x}=ge(),c=le(),P=ce(),d=S=>x(S),{values:r,isLoading:A,validateAndSubmit:U,callbacks:l}=De(K,"user/user-profile-update",{locations:[],availableForCommunity:!1}),B=I([]),a=()=>{const S=P.user;r.value.locations=JSON.parse(JSON.stringify((S.locations||[]).filter(N=>!N.isBusinessLocation))),r.value.availableForCommunity=S.availableForCommunity||!1,r.value.availableForPaidProfessionalService=S.availableForPaidProfessionalService||!1,B.value=new Array(r.value.locations.length).fill(!1)};re(a);const V=async S=>{var N;try{const Q=[...r.value.locations];Q.splice(S,1),r.value.locations=Q,B.value.splice(S,1),await U(!1),(N=_.reloadComponents)==null||N.call(_),s("reloadComponents")}catch(Q){console.error("Error removing location:",Q),a(),c.notify({color:"negative",message:x("common.errorRemovingLocation"),icon:"error",position:"top-right"})}},R=(S,N,Q,L)=>{const fe=S*Math.PI/180,Ie=Q*Math.PI/180,xe=(Q-S)*Math.PI/180,Ve=(L-N)*Math.PI/180,Ae=Math.sin(xe/2)*Math.sin(xe/2)+Math.cos(fe)*Math.cos(Ie)*Math.sin(Ve/2)*Math.sin(Ve/2),Qe=2*Math.atan2(Math.sqrt(Ae),Math.sqrt(1-Ae));return 6371e3*Qe},z=async S=>{B.value[S]=!0;try{const N=await Re.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}),Q=N.coords.latitude,L=N.coords.longitude;if(r.value.locations.some((fe,Ie)=>{if(Ie===S||!H(fe))return!1;const[xe,Ve]=fe.location.coordinates;return R(Q,L,Ve,xe)<500})){r.value.locations[S].location.coordinates=[null,null],r.value.locations[S].name="",c.notify({color:"negative",message:x("common.locationTooClose"),icon:"error",position:"top-right"});return}r.value.locations[S].location.coordinates=[N.coords.longitude,N.coords.latitude],await U(!1)}catch(N){console.error("Error getting location",N),c.notify({color:"negative",message:x("common.locationError"),icon:"error",position:"top-right"})}finally{B.value[S]=!1}},H=S=>{const[N,Q]=S.location.coordinates;return Q!==null&&N!==null},T=G(()=>r.value.availableForCommunity?r.value.locations.every(H):!0),X=S=>{const[N,Q]=S.location.coordinates;return Q&&N?`${x("common.coordinates")}: ${Q.toFixed(6)}, ${N.toFixed(6)}`:""},_=y,s=p;l.onSuccess=S=>{P.updateUser(S.user),a(),c.notify({color:"green",message:x("common.volunteeringUpdateSuccess"),icon:"check",position:"top-right"}),console.log("success dialog updated"),f()},l.onError=async S=>{console.error("Error updating volunteering info",S),c.notify({color:"negative",message:x("common.volunteeringUpdateError"),icon:"error",position:"top-right"})};const b=async()=>{var S;if(T.value)try{await U(!1),(S=_.reloadComponents)==null||S.call(_),s("reloadComponents")}catch(N){console.error("Form submission error:",N),c.notify({color:"negative",message:x("common.pleaseSelectAllLocations"),icon:"error",position:"top-right"})}else c.notify({color:"negative",message:x("common.pleaseSelectAllLocations"),icon:"error",position:"top-right"})},h=S=>{const[N,Q]=S,L=`https://www.google.com/maps/search/?api=1&query=${Q},${N}`;window.open(L,"_blank")};F({$t:d,values:r,isLoading:A,locationLoading:B,isLocationValid:H,getLocationCoordinates:X,updateLocationCoordinates:z,removeNotificationLocation:V,openGoogleMaps:h,handleSubmit:b,isFormValid:T});const w=I(!1),u=I({name:"",location:{type:"Point",coordinates:[null,null]}}),k=I(!1),v=I(!1),m=G(()=>r.value.locations.length>0),t=G(()=>u.value.name.trim()!==""&&u.value.location.coordinates[0]!==null&&u.value.location.coordinates[1]!==null),g=async()=>{var S;try{await U(!1),(S=_.reloadComponents)==null||S.call(_),s("reloadComponents")}catch(N){console.error("Error updating availability:",N),c.notify({color:"negative",message:x("common.updateError"),icon:"error",position:"top-right"})}},f=()=>{u.value={name:"",location:{type:"Point",coordinates:[null,null]}},w.value=!1},E=I(!1),W=S=>{u.value.location={type:"Point",coordinates:[S.coordinates[0],S.coordinates[1]]},E.value=!1},q=async()=>{var S;if(!t.value){c.notify({color:"negative",message:x("common.pleaseSelectLocation"),icon:"error",position:"top-right"});return}v.value=!0;try{const N=[...r.value.locations,{...u.value}];r.value.locations=N,await U(!1),f(),(S=_.reloadComponents)==null||S.call(_),s("reloadComponents")}catch(N){console.error("Error adding location:",N),a(),c.notify({color:"negative",message:x("common.errorAddingLocation"),icon:"error",position:"top-right"})}finally{v.value=!1}};return(S,N)=>(C(),M(Ee,{class:"volunteering-page"},{default:n(()=>{var Q;return[o("div",Jo,[o("h5",Zo,$(d("common.volunteeringSettings")),1),o("p",et,$(d("common.notificationLocationsHelp")),1),e(ee,{flat:"",bordered:"",class:"q-mb-md"},{default:n(()=>[e(J,null,{default:n(()=>[o("div",ot,$(d("common.availabilitySettings")),1),e($e,null,{default:n(()=>[se((C(),M(ie,{tag:"label"},{default:n(()=>[e(Z,null,{default:n(()=>[e(ae,null,{default:n(()=>[Y($(d("common.availableForCommunity")),1)]),_:1}),e(ae,{caption:""},{default:n(()=>[Y($(d("common.availableForCommunityDescription")),1)]),_:1})]),_:1}),e(Z,{side:""},{default:n(()=>[e(ye,{modelValue:i(r).availableForCommunity,"onUpdate:modelValue":[N[0]||(N[0]=L=>i(r).availableForCommunity=L),g],color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})),[[_e]])]),_:1})]),_:1})]),_:1}),o("div",tt,[i(r).locations.length<10?(C(),M(D,{key:0,icon:"add",color:"primary",class:"full-width custom-radius q-mb-md",onClick:N[1]||(N[1]=L=>(w.value=!w.value,E.value=w.value)),label:d("common.addNotificationLocation"),style:{"border-radius":"10px !important"},disable:!i(r).availableForCommunity},null,8,["label","disable"])):j("",!0),w.value?(C(),O("div",at,[o("div",st,[o("label",null,$(d("common.locationName")),1),e(te,{modelValue:u.value.name,"onUpdate:modelValue":N[2]||(N[2]=L=>u.value.name=L),filled:"",class:"custom-radius","bg-color":"pink-1",dense:"","hide-bottom-space":""},null,8,["modelValue"])]),o("div",nt,[e(D,{flat:"",color:"white",style:{"border-radius":"10px !important"},icon:"my_location",class:"full-width custom-radius bg-primary",onClick:N[3]||(N[3]=L=>E.value=!0),loading:k.value},{default:n(()=>[Y($(d("common.setLocation")),1)]),_:1},8,["loading"]),(Q=u.value.location)!=null&&Q.coordinates[0]?(C(),O("div",lt,$(X(u.value)),1)):j("",!0)]),o("div",it,[o("div",rt,[e(D,{label:"Cancel",color:"black",style:{"border-radius":"10px !important"},class:"full-width custom-radius",onClick:f})]),o("div",ut,[e(D,{label:"Add",color:"primary",style:{"border-radius":"10px !important"},class:"full-width custom-radius",onClick:q,disabled:!t.value,loading:v.value},null,8,["disabled","loading"])])])])):j("",!0),w.value?(C(),M(Ce,{key:2,class:"q-mt-md"})):j("",!0),m.value?(C(),O("div",ct,[(C(!0),O(we,null,Se(i(r).locations,(L,ke)=>(C(),M(ee,{key:ke,flat:"",bordered:"",class:"contact-card q-mb-sm"},{default:n(()=>[e(J,{class:"row items-center",style:{width:"100%"}},{default:n(()=>[o("div",dt,[e(Ue,null,{default:n(()=>N[5]||(N[5]=[o("img",{src:"https://static.vecteezy.com/system/resources/thumbnails/051/222/604/small/3d-pink-location-pin-on-map-icon-png.png",alt:"/profile.png"},null,-1)])),_:1})]),o("div",mt,[o("div",pt,$(L.name),1),H(L)?(C(),O("div",vt,$(X(L)),1)):j("",!0)]),o("div",gt,[o("div",ft,[e(D,{flat:"",dense:"",round:"",class:"q-mb-0 text-blue q-mb-sm",icon:"mdi-directions",disable:!H(L),onClick:fe=>h(L.location.coordinates)},{default:n(()=>[e(Oe,null,{default:n(()=>[Y($(d("common.viewOnMap")),1)]),_:1})]),_:2},1032,["disable","onClick"])]),o("div",null,[e(D,{class:"remove-btn",flat:"",label:"Remove",style:{"border-radius":"10px !important"},onClick:fe=>V(ke)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))])):j("",!0),!m.value&&i(r).availableForCommunity?(C(),O("p",yt," No location Added ")):j("",!0)])]),e(Be,{modelValue:E.value,"onUpdate:modelValue":N[4]||(N[4]=L=>E.value=L),onLocationSelected:W},null,8,["modelValue"])]}),_:1}))}});var ht=de(bt,[["__scopeId","data-v-50739d61"]]);const _t={class:"page"},Ct={class:"content"},$t={class:"history-container"},wt={key:0,class:"loading-spinner"},St={key:1,class:"no-history"},kt={key:2,class:"history-list"},xt={class:"history-card"},Vt={class:"card-header"},qt={class:"card-title text-capitalize"},It={class:"card-subtitle",style:{"margin-top":"-20px","margin-bottom":"10px"}},At={class:"card-content"},Nt={class:"location-info"},Pt=["disabled","onClick"],Lt={key:1,class:"rated-text"},Et={key:3,class:"load-more-container"},Ut=["disabled"],Ot={key:0,class:"button-loader"},Dt={key:1},Ft=1e3,Bt=ne({__name:"SosHistoryPage",setup(y){const F=ce(),p=le();Te();const x=I(!0),c=new Map;let P=0;const d=I(1),r=I(5),A=I(!0),U=I([]),l=I([]),B=I(!1),a=async s=>{const[b,h]=s,w=`${h},${b}`;if(c.has(w))return c.get(w);const u=Date.now(),k=Math.max(0,Ft-(u-P));k>0&&await new Promise(v=>setTimeout(v,k));try{P=Date.now();const m=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${h}&lon=${b}`,{headers:{"Accept-Language":"en-US,en;q=0.9","User-Agent":"Nirbhaya-App"}})).json();let t="Location not available";return m.display_name&&(t=m.display_name.split(",").slice(0,3).join(",")),c.set(w,t),t}catch(v){return console.error("Error getting address:",v),"Location not available"}},V=async()=>{try{const s=F.user.id,b=await K.get("/sos/sos-history",{params:{userId:s}});U.value=b.data,R(),await X()}catch(s){console.error("Error fetching SOS history:",s)}finally{x.value=!1}},R=()=>{const b=d.value*r.value;l.value=U.value.slice(0,b),A.value=b<U.value.length},z=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),H=s=>{p.dialog({component:ro,componentProps:{eventId:s.toString()},position:"bottom",seamless:!0,fullWidth:!0}).onOk(()=>{V()}).onCancel(()=>{console.log("Dialog cancelled")})},T=s=>s!=null&&s.address?s.address:s!=null&&s.coordinates?"Fetching location...":"Location not available",X=async()=>{var s;for(const b of l.value)if(((s=b.location)==null?void 0:s.coordinates)&&!b.location.address){const h=await a(b.location.coordinates);b.location.address=h;const w=U.value.find(u=>u.id===b.id);w&&(w.location.address=h)}},_=async()=>{var h;if(!A.value||B.value)return;B.value=!0,d.value++,R();const s=(d.value-1)*r.value,b=l.value.slice(s);for(const w of b)if(((h=w.location)==null?void 0:h.coordinates)&&!w.location.address){const u=await a(w.location.coordinates);w.location.address=u;const k=U.value.find(v=>v.id===w.id);k&&(k.location.address=u)}B.value=!1};return re(()=>{V()}),(s,b)=>(C(),O("div",_t,[o("main",Ct,[o("div",$t,[x.value?(C(),O("div",wt,b[0]||(b[0]=[o("div",{class:"spinner"},null,-1)]))):U.value.length===0?(C(),O("div",St,b[1]||(b[1]=[o("h4",null,"No SOS history found",-1)]))):(C(),O("div",kt,[(C(!0),O(we,null,Se(l.value,h=>(C(),O("div",{key:h.id,class:"history-item"},[o("div",xt,[o("div",Vt,[o("div",qt,$(h.threat?h.threat:"Emergency Alert"),1)]),o("div",It,$(z(h.createdAt)),1),o("div",{class:"card-subtitle",style:io([{"margin-top":"-10px","margin-bottom":"10px"},{color:h.status==="resolved"?"#4CAF50":"#F44336"}])},$(h.status),5),o("div",At,[o("div",Nt,[b[2]||(b[2]=o("span",{class:"material-icons"},"location_on",-1)),o("p",null,$(T(h.location)),1)]),h.isRated?(C(),O("p",Lt,"Already rated")):(C(),O("button",{key:0,disabled:h.status=="cancelled",class:"rate-button",onClick:w=>H(h.id)}," Rate Helper ",8,Pt))])])]))),128))])),A.value?(C(),O("div",Et,[o("button",{class:"load-more-button",onClick:_,disabled:B.value},[B.value?(C(),O("span",Ot)):(C(),O("span",Dt,"Load More"))],8,Ut)])):j("",!0)])])]))}});var Rt=de(Bt,[["__scopeId","data-v-c102eea0"]]);function Tt(y){const F=document.createElement("textarea");F.value=y,F.contentEditable="true",F.style.position="fixed";const p=()=>{};uo(p),document.body.appendChild(F),F.focus(),F.select();const x=document.execCommand("copy");return F.remove(),co(p),x}function Mt(y){return navigator.clipboard!==void 0?navigator.clipboard.writeText(y):new Promise((F,p)=>{const x=Tt(y);x?F(!0):p(x)})}const Qt={class:"community-impact-page"},zt={class:"text-h6"},Ht={class:"text-h3 text-primary q-mt-sm q-pr-xl",style:{position:"relative"}},jt={class:"row q-col-gutter-md"},Gt={class:"col-12 col-sm-6"},Wt={class:"text-subtitle1"},Yt={class:"text-h5"},Kt={class:"col-12 col-sm-6"},Xt={class:"text-subtitle1"},Jt={class:"text-h5"},Zt=ne({__name:"CommunityImpactPage",setup(y){const F=ce(),p=I({referralId:"",peopleEncouraged:0,locationsSecured:0}),x=I(null);I(null);const c=I(null);I([]);const P=I(!1);I("");const d=I(null),r=I({imageSrc:"",imageX:10,imageY:10,imageWidth:100,imageHeight:100,text:"#SOSBharat",textColor:"#ffffff",textX:20,textY:40,textSize:24});I(!1),I(null);const A=I("Copy"),U=()=>{const a=`${F.user.referralId}`;Mt(a).then(()=>{A.value="Copied!",setTimeout(()=>{A.value="Copy"},2e3)}).catch(V=>{console.error("Failed to copy: ",V)})},l=()=>{if(!d.value||!x.value)return;const a=d.value.getContext("2d");!a||(a.drawImage(x.value,0,0,d.value.width,d.value.height),a.fillStyle=r.value.textColor,a.font=`${r.value.textSize}px Arial`,a.fillText(r.value.text,r.value.textX,r.value.textY),r.value.imageSrc,P.value&&requestAnimationFrame(l))};ve(r,l,{deep:!0}),le(),mo(()=>{c.value&&P.value&&c.value.stop()});const B=async()=>{try{const a=await K.get("/leaderboard/referral-info");p.value=a.data}catch(a){console.error("Error fetching impact info",a)}};return re(()=>{console.log("platform",po.is),B()}),ve(x,a=>{a&&(a.onloadedmetadata=()=>{d.value&&(d.value.width=a.videoWidth,d.value.height=a.videoHeight),l()})},{immediate:!0}),(a,V)=>(C(),O("div",Qt,[e(ee,{class:"q-mb-md"},{default:n(()=>[e(J,null,{default:n(()=>[o("div",zt,$(a.$t("common.yourReferralId")),1),o("div",Ht,[Y($(i(F).user.referralId)+" ",1),e(D,{flat:"",round:"",class:"absolute-right",onClick:U},{default:n(()=>[e(ue,{name:"content_copy"}),e(Oe,null,{default:n(()=>[Y($(A.value),1)]),_:1})]),_:1})])]),_:1})]),_:1}),e(ee,{class:"q-mb-md"},{default:n(()=>[e(J,null,{default:n(()=>[o("div",jt,[o("div",Gt,[o("div",Wt,$(a.$t("common.peopleYouHaveEncouraged")),1),o("div",Yt,$(p.value.peopleEncouraged),1)]),o("div",Kt,[o("div",Xt,$(a.$t("common.locationsSecured")),1),o("div",Jt,$(p.value.locationsSecured),1)])])]),_:1})]),_:1})]))}});var ea=de(Zt,[["__scopeId","data-v-a711b94c"]]);const oa={key:0,class:"q-px-lg q-mt-md"},ta={key:1,style:{padding:"16px"}},aa=ne({name:"ProfileAppPermission",__name:"ProfileAppPermission",props:{reloadComponents:{type:Function}},emits:["reloadComponents"],setup(y,{emit:F}){var V,R,z,H,T,X;const p=y,x=F,{t:c}=ge(),P=le(),d=ce(),r=I({startAudioVideoRecordOnSos:(R=(V=d.user)==null?void 0:V.startAudioVideoRecordOnSos)!=null?R:!1,streamAudioVideoOnSos:(H=(z=d.user)==null?void 0:z.streamAudioVideoOnSos)!=null?H:!1,broadcastAudioOnSos:(X=(T=d.user)==null?void 0:T.broadcastAudioOnSos)!=null?X:!0});re(()=>{var _,s,b;d.user&&(r.value={startAudioVideoRecordOnSos:(_=d.user.startAudioVideoRecordOnSos)!=null?_:!1,streamAudioVideoOnSos:(s=d.user.streamAudioVideoOnSos)!=null?s:!1,broadcastAudioOnSos:(b=d.user.broadcastAudioOnSos)!=null?b:!0}),B()});const A=G(()=>"true"),U=G(()=>typeof navigator!="undefined"&&navigator.mediaDevices!==void 0),l=I([{name:"common.location",granted:!1},{name:"common.camera",granted:!1}]),B=async()=>{for(const _ of l.value)try{let s;if(vo.isNativePlatform())switch(_.name){case"location":s=await Re.checkPermissions(),_.granted=s.location==="granted";break;case"camera":s=await fo.checkPermissions(),_.granted=s.camera==="granted";break;case"microphone":s=await go.Permissions.query({name:"microphone"}),_.granted=s.state==="granted";break}else if(_.name==="location")s=await navigator.permissions.query({name:"geolocation"}),_.granted=s.state==="granted";else try{await navigator.mediaDevices.getUserMedia({video:_.name==="camera",audio:_.name==="microphone"}),_.granted=!0}catch{_.granted=!1}}catch(s){console.error(`Error checking ${_.name} permission:`,s)}},a=async _=>{var s;try{d.updateUserSettings({[_]:r.value[_]}),await K.post("user/media-broadcast-permission",{[_]:r.value[_],userId:d.user.id}),(s=p.reloadComponents)==null||s.call(p),x("reloadComponents")}catch(b){console.error("Error updating settings:",b),r.value[_]=!r.value[_],d.updateUserSettings({[_]:!r.value[_]}),P.notify({color:"negative",message:c("common.errorSavingSettings"),icon:"error",position:"top-right"})}};return ve(()=>d.user,_=>{var s,b,h;_&&(r.value={startAudioVideoRecordOnSos:(s=_.startAudioVideoRecordOnSos)!=null?s:!1,streamAudioVideoOnSos:(b=_.streamAudioVideoOnSos)!=null?b:!1,broadcastAudioOnSos:(h=_.broadcastAudioOnSos)!=null?h:!0})},{deep:!0}),(_,s)=>(C(),O("div",null,[U.value?(C(),O("div",oa,[e($e,{bordered:""},{default:n(()=>[se((C(),M(ie,{tag:"label"},{default:n(()=>[e(Z,null,{default:n(()=>[e(ae,null,{default:n(()=>[Y($(_.$t("common.startAudioVideoRecordOnSos")),1)]),_:1})]),_:1}),e(Z,{side:""},{default:n(()=>[e(ye,{modelValue:r.value.startAudioVideoRecordOnSos,"onUpdate:modelValue":[s[0]||(s[0]=b=>r.value.startAudioVideoRecordOnSos=b),s[1]||(s[1]=b=>a("startAudioVideoRecordOnSos"))]},null,8,["modelValue"])]),_:1})]),_:1})),[[_e]]),A.value?se((C(),M(ie,{key:0,tag:"label"},{default:n(()=>[e(Z,null,{default:n(()=>[e(ae,null,{default:n(()=>[Y($(_.$t("common.streamAudioVideoOnSos")),1)]),_:1})]),_:1}),e(Z,{side:""},{default:n(()=>[e(ye,{modelValue:r.value.streamAudioVideoOnSos,"onUpdate:modelValue":[s[2]||(s[2]=b=>r.value.streamAudioVideoOnSos=b),s[3]||(s[3]=b=>a("streamAudioVideoOnSos"))]},null,8,["modelValue"])]),_:1})]),_:1})),[[_e]]):j("",!0),se((C(),M(ie,{tag:"label"},{default:n(()=>[e(Z,null,{default:n(()=>[e(ae,null,{default:n(()=>[Y($(_.$t("common.broadcastAudioOnSos")),1)]),_:1})]),_:1}),e(Z,{side:""},{default:n(()=>[e(ye,{modelValue:r.value.broadcastAudioOnSos,"onUpdate:modelValue":[s[4]||(s[4]=b=>r.value.broadcastAudioOnSos=b),s[5]||(s[5]=b=>a("broadcastAudioOnSos"))],color:"grey",disable:!0},null,8,["modelValue"])]),_:1})]),_:1})),[[_e]])]),_:1})])):(C(),O("div",ta,[e(yo,{dense:"","inline-actions":"",class:"bg-grey-2"},{action:n(()=>[e(D,{flat:"",icon:"warning",color:"red"})]),default:n(()=>[s[6]||(s[6]=Y(" Your device is not supported. Please check your settings or try a different device. "))]),_:1})]))]))}}),sa={class:"text-h6"},na={key:1,class:"text-center q-pa-md"},la=ne({__name:"EmergencyContactRequestsDialog",setup(y){ge(),le();const{dialogRef:F}=bo(),p=I([]);re(async()=>{await x()});const x=async()=>{try{const d=await K.get("/user/emergency-contacts");p.value=d.data}catch(d){console.error("Error fetching emergency contacts:",d)}},c=async d=>{try{await K.post(`/user/approve-emergency-contact/${d}`),await x()}catch(r){console.error("Error approving contact:",r)}},P=async d=>{try{await K.post(`/user/remove-emergency-contact/${d}`),p.value=p.value.filter(r=>r.id!==d)}catch(r){console.error("Error removing contact:",r)}};return(d,r)=>(C(),M(qe,{ref_key:"dialogRef",ref:F},{default:n(()=>[e(ee,{class:"q-dialog-plugin",style:{width:"500px","max-width":"80vw"}},{default:n(()=>[e(J,null,{default:n(()=>[o("div",sa,$(d.$t("common.emergencyContacts")),1)]),_:1}),e(J,{class:"q-pt-none"},{default:n(()=>[p.value.length>0?(C(),M($e,{key:0},{default:n(()=>[(C(!0),O(we,null,Se(p.value,A=>(C(),M(ie,{key:A.id},{default:n(()=>[e(Z,null,{default:n(()=>[e(ae,null,{default:n(()=>[Y($(A.requesterName),1)]),_:2},1024),e(ae,{caption:""},{default:n(()=>[Y($(A.requesterPhone),1)]),_:2},1024),e(ae,{caption:""},{default:n(()=>[Y($(A.consentGiven?d.$t("common.approved"):d.$t("common.pending")),1)]),_:2},1024)]),_:2},1024),e(Z,{side:""},{default:n(()=>[A.consentGiven?j("",!0):(C(),M(D,{key:0,flat:"",color:"positive",onClick:U=>c(A.id),label:d.$t("common.approve")},null,8,["onClick","label"])),e(D,{flat:"",color:"negative",onClick:U=>P(A.id),label:d.$t("common.remove")},null,8,["onClick","label"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(C(),O("div",na,$(d.$t("common.noEmergencyContacts")),1))]),_:1}),e(Me,{align:"right"},{default:n(()=>[se(e(D,{color:"primary",flat:"",label:d.$t("common.close")},null,8,["label"]),[[he]])]),_:1})]),_:1})]),_:1},512))}});const ia={class:"scrollable-inputs"},ra={class:"row q-col-gutter-sm q-mb-md q-mt-xs"},ua={class:"col-6"},ca={class:"col-6"},da={key:0,class:"input-fields"},ma={class:"custom-input"},pa={class:"custom-input"},va={class:"custom-input"},ga={class:"row q-col-gutter-sm"},fa={class:"col-6"},ya={class:"col-6"},ba={key:2,class:"contact-cards q-mt-md"},ha={class:"col-auto"},_a={class:"col"},Ca={class:"text-subtitle2 row items-center"},$a={class:"text-caption"},wa={class:"col-auto q-ml-auto"},Sa={key:3,class:"text-negative q-mt-sm"},ka=ne({__name:"EmergencyContactPage",props:{reloadComponents:{type:Function}},emits:["reloadComponents"],setup(y,{emit:F}){const p=y,x=F,{t:c}=ge(),P=le(),d=ce(),{values:r,errors:A,isLoading:U,validateAndSubmit:l,callbacks:B}=De(K,"user/emergency-contacts-add",{emergencyContacts:[]}),a=async()=>{const u=d.user;r.value.emergencyContacts=u.emergencyContacts||[];try{const v=(await K.get("/user/emergency-contacts-status")).data;r.value.emergencyContacts=r.value.emergencyContacts.map(m=>{const t=v.find(g=>g.contactPhone===m.contactPhone);return{...m,consentGiven:t?t.consentGiven:!1}})}catch(k){console.error("Error fetching emergency contacts status:",k)}};re(()=>{a()});const V=I(!1),R=I({contactName:"",contactPhone:"",relationship:void 0,isAppUser:!0,priority:0,consentGiven:!1,is_primary:!1}),z=()=>{R.value={contactName:"",contactPhone:"",relationship:void 0,isAppUser:!0,priority:0,consentGiven:!1,is_primary:!1},V.value=!1},H=I(!1),T=async()=>{if(R.value.contactName&&R.value.contactPhone){if(r.value.emergencyContacts.some(v=>v.contactPhone===R.value.contactPhone)){P.notify({color:"negative",message:c("common.phoneNumberAlreadyExists"),icon:"error",position:"top-right"});return}if(!await s(R.value.contactPhone,r.value.emergencyContacts.length))return;try{H.value=!0,r.value.emergencyContacts.push({contactName:R.value.contactName,contactPhone:R.value.contactPhone,relationship:R.value.relationship,isAppUser:!0,priority:0,consentGiven:!1,is_primary:R.value.is_primary,touched:!0}),await l(!1),z(),await a()}catch(v){console.error("Error adding emergency contact:",v),P.notify({color:"negative",message:c("common.errorAddingContact"),icon:"error",position:"top-right"})}finally{H.value=!1}}else P.notify({color:"negative",message:c("common.fillRequiredFields"),icon:"error",position:"top-right"})},X=async u=>{P.dialog({title:c("common.confirm"),message:c("common.confirmDeleteContact"),cancel:!0,persistent:!0,ok:{label:c("common.delete"),color:"black"},cancel:{label:c("common.cancel"),color:"grey"}}).onOk(async()=>{try{const k=r.value.emergencyContacts[u],v=d.user.id;await K.post("/user/emergency-contact",{userId:v,contactPhone:k.contactPhone}),r.value.emergencyContacts.splice(u,1),await l(!1),d.updateUser({...d.user,emergencyContacts:r.value.emergencyContacts}),await a()}catch(k){console.error("Error deleting emergency contact:",k),P.notify({color:"negative",message:c("common.emergencyContactDeleteError"),icon:"error",position:"top-right"})}})},_=G(()=>r.value.emergencyContacts.length>0);G(()=>{const u=r.value.emergencyContacts.length>0,k=r.value.emergencyContacts.some(t=>{var g,f;return((g=t.contactName)==null?void 0:g.trim())||((f=t.contactPhone)==null?void 0:f.trim())}),v=r.value.emergencyContacts.every(t=>{var g,f,E,W;return((g=t.contactName)==null?void 0:g.trim())||((f=t.contactPhone)==null?void 0:f.trim())?((E=t.contactName)==null?void 0:E.trim())&&((W=t.contactPhone)==null?void 0:W.trim())&&t.contactPhone.length===10:!0}),m=Object.keys(A.value).length===0;return u&&k&&v&&m});const s=async(u,k)=>{try{return u===d.user.phoneNumber?(A.value[`emergencyContact${k}`]=c("common.cantAddOwnNumber"),!1):(await K.post("auth/validate-phone",{phoneNumber:u})).data.isValid?(delete A.value[`emergencyContact${k}`],!0):(A.value[`emergencyContact${k}`]=c("common.userNotRegisteredInApp"),!1)}catch(v){return console.error("Error validating phone number:",v),A.value[`emergencyContact${k}`]=c("common.phoneValidationError"),!1}},b=async(u,k)=>{u.contactPhone&&await s(u.contactPhone,k)};B.onSuccess=u=>{var k;d.updateUser({...d.user,emergencyContacts:r.value.emergencyContacts}),a(),(k=p.reloadComponents)==null||k.call(p),x("reloadComponents"),P.notify({color:"black",message:"Emergency Contacts Updated Successfully",icon:"check",position:"top-right"})},B.onError=async u=>{console.error("Error updating emergency contacts",u),P.notify({color:"negative",message:c("common.emergencyContactsUpdateError"),icon:"error",position:"top-right"})};const h=()=>{P.dialog({component:la})},w=G(()=>{var u,k;return((k=(u=r.value)==null?void 0:u.emergencyContacts)==null?void 0:k.length)||0});return(u,k)=>(C(),M(Ee,{class:"q-pa-xs"},{default:n(()=>[e(ee,{flat:"",class:"emergency-contacts-card"},{default:n(()=>[e(J,null,{default:n(()=>[k[7]||(k[7]=o("h5",{class:"text-h6 q-mb-sm q-ma-none"},"Emergency Contacts",-1)),k[8]||(k[8]=o("p",{class:"q-ma-none q-mb-sm"},"Add Your emergency contacts below.",-1)),o("div",ia,[o("div",ra,[o("div",ua,[e(D,{icon:"add",color:"primary",class:"full-width custom-radius",onClick:k[0]||(k[0]=v=>V.value=!V.value),label:i(c)("common.addEmergencyContact"),style:{"border-radius":"10px !important"},"no-caps":""},null,8,["label"])]),o("div",ca,[e(D,{onClick:h,color:"secondary",class:"full-width custom-radius",icon:i(c)("common.icons.contacts"),label:i(c)("common.emergencyContactRequests"),style:{"border-radius":"10px !important"},"no-caps":""},null,8,["icon","label"])])]),V.value?(C(),O("div",da,[o("div",ma,[o("label",null,$(i(c)("common.name")),1),e(te,{modelValue:R.value.contactName,"onUpdate:modelValue":k[1]||(k[1]=v=>R.value.contactName=v),rules:[v=>!!v||i(c)("common.nameRequired")],filled:"",class:"custom-radius","bg-color":"pink-1",dense:"","hide-bottom-space":""},null,8,["modelValue","rules"])]),o("div",pa,[o("label",null,$(i(c)("common.mobileNumber")),1),e(te,{modelValue:R.value.contactPhone,"onUpdate:modelValue":k[2]||(k[2]=v=>R.value.contactPhone=v),error:!!i(A)[`emergencyContact${w.value}`],"error-message":i(A)[`emergencyContact${w.value}`],filled:"",class:"custom-radius","bg-color":"pink-1",dense:"",type:"tel",mask:"##########","hide-bottom-space":"",onBlur:k[3]||(k[3]=()=>b(R.value,w.value))},null,8,["modelValue","error","error-message"])]),o("div",va,[e(ho,{modelValue:R.value.is_primary,"onUpdate:modelValue":k[4]||(k[4]=v=>R.value.is_primary=v),label:"Set as primary contact"},null,8,["modelValue"])]),o("div",ga,[o("div",fa,[e(D,{label:"Cancel",color:"black",style:{"border-radius":"10px !important"},class:"full-width custom-radius",onClick:z})]),o("div",ya,[e(D,{label:"Add",color:"primary",style:{"border-radius":"10px !important"},class:"full-width custom-radius",onClick:T,loading:H.value},{loading:n(()=>[e(_o)]),_:1},8,["loading"])])])])):j("",!0),V.value?(C(),M(Ce,{key:1,class:"q-mt-md"})):j("",!0),_.value?(C(),O("div",ba,[(C(!0),O(we,null,Se(i(r).emergencyContacts,(v,m)=>(C(),M(ee,{key:m,flat:"",bordered:"",class:"contact-card q-mb-sm"},{default:n(()=>[e(J,{class:"row items-center",style:{width:"100%"}},{default:n(()=>[o("div",ha,[e(Ue,null,{default:n(()=>k[5]||(k[5]=[o("img",{src:"/profile.png",alt:"/profile.png"},null,-1)])),_:1})]),o("div",_a,[o("div",Ca,[Y($(v.contactName)+" ",1),v.is_primary?(C(),M(ue,{key:0,name:"check_circle",color:"positive",size:"xs",class:"q-ml-sm"},{default:n(()=>[e(Oe,null,{default:n(()=>k[6]||(k[6]=[Y("Primary Contact")])),_:1})]),_:1})):j("",!0)]),o("div",$a,$(v.contactPhone),1),o("div",null," Approval Status: ("+$(v.consentGiven?"Approved":"Pending")+") ",1)]),o("div",wa,[e(D,{class:"remove-btn",flat:"",label:"Remove",style:{"border-radius":"10px !important"},onClick:t=>X(m)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])):(C(),O("p",Sa,$(i(c)("common.noEmergencyContacts")),1))])]),_:1})]),_:1})]),_:1}))}});var xa=de(ka,[["__scopeId","data-v-31f9bea2"]]);const Va={class:"row q-col-gutter-md"},qa={class:"col-12 col-md-4"},Ia={class:"q-mt-md"},Aa={class:"q-mt-md"},Na={key:0,class:"q-mt-md"},Pa={class:"q-mt-md"},La={class:"col-12 col-md-8"},Ea={class:"row items-center"},Ua={class:"q-mt-md"},Oa={class:"row q-gutter-sm"},Da={class:"text-h6"},Fa={class:"q-mt-md image-upload-container"},Ba={key:0,class:"preview-container"},Le="https://xavoc-technocrats-pvt-ltd.blr1.cdn.digitaloceanspaces.com/",Ra=ne({__name:"ManageCatalogDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close"],setup(y,{emit:F}){const p=le(),x=I(!1),c=I(!1),P=I(!1),d=I(!1),r=I(null),A=I({title:"",imageUrl:"",sequence:0}),U=I(null),l=I(""),B=F,a=I({hasCatalog:!1,doesDelivery:!1,deliveryText:"",deliveryRange:5e3,catalogItems:[]}),V=async()=>{try{x.value=!0;const h=await K.get("/community/business-catalog");a.value=h.data}catch{p.notify({type:"negative",message:"Failed to load catalog information",position:"top"})}finally{x.value=!1}},R=async()=>{try{c.value=!0,await K.post("/community/business-catalog",a.value),p.notify({type:"positive",message:"Catalog settings saved successfully",position:"top"}),B("update:modelValue",!1),B("close")}catch{p.notify({type:"negative",message:"Failed to save catalog settings",position:"top"})}finally{c.value=!1}},z=h=>{h?l.value=URL.createObjectURL(h):l.value=""},H=h=>{h?(r.value=h,A.value={...h},l.value=h.imageUrl?Le+h.imageUrl:""):(r.value=null,A.value={title:"",imageUrl:"",sequence:a.value.catalogItems.length},l.value=""),U.value=null,P.value=!0},T=async()=>{try{d.value=!0;const h=new FormData;h.append("title",A.value.title),h.append("sequence",String(A.value.sequence)),U.value&&h.append("image",U.value),r.value?await K.put(`/community/catalog-items/${r.value.id}`,h,{headers:{"Content-Type":"multipart/form-data"}}):await K.post("/community/catalog-items",h,{headers:{"Content-Type":"multipart/form-data"}}),await V(),P.value=!1,U.value=null,l.value="",p.notify({type:"positive",message:`Item ${r.value?"updated":"added"} successfully`,position:"top"})}catch{p.notify({type:"negative",message:`Failed to ${r.value?"update":"add"} item`,position:"top"})}finally{d.value=!1}},X=h=>{p.dialog({title:"Confirm Delete",message:"Are you sure you want to delete this item?",cancel:!0,persistent:!0}).onOk(async()=>{try{await K.delete(`/community/catalog-items/${h.id}`),await V(),p.notify({type:"positive",message:"Item deleted successfully",position:"top"})}catch{p.notify({type:"negative",message:"Failed to delete item",position:"top"})}})},_=I(!1),s=I(""),b=h=>{s.value=Le+h,_.value=!0};return re(()=>{V()}),(h,w)=>(C(),M(qe,{"model-value":h.modelValue,"onUpdate:modelValue":w[10]||(w[10]=u=>h.$emit("update:modelValue",u)),persistent:"",maximized:""},{default:n(()=>[e(ee,{class:"dialog-card"},{default:n(()=>[e(J,{class:"row items-center"},{default:n(()=>[w[11]||(w[11]=o("div",{class:"text-h6"},"Manage Catalog",-1)),e(Ne),se(e(D,{icon:"close",flat:"",round:"",dense:""},null,512),[[he]])]),_:1}),e(J,null,{default:n(()=>[o("div",Va,[o("div",qa,[e(ee,{flat:"",bordered:""},{default:n(()=>[e(J,null,{default:n(()=>[w[12]||(w[12]=o("div",{class:"text-subtitle1"},"Catalog Settings",-1)),o("div",Ia,[e(ye,{modelValue:a.value.hasCatalog,"onUpdate:modelValue":w[0]||(w[0]=u=>a.value.hasCatalog=u),label:"Enable Product Catalog",color:"primary"},null,8,["modelValue"])]),o("div",Aa,[e(ye,{modelValue:a.value.doesDelivery,"onUpdate:modelValue":w[1]||(w[1]=u=>a.value.doesDelivery=u),label:"Provide Delivery",color:"primary"},null,8,["modelValue"])]),a.value.doesDelivery?(C(),O("div",Na,[e(te,{modelValue:a.value.deliveryText,"onUpdate:modelValue":w[2]||(w[2]=u=>a.value.deliveryText=u),label:"Delivery Information",filled:"",hint:"Delivery terms, minimum order value etc."},null,8,["modelValue"]),e(te,{modelValue:a.value.deliveryRange,"onUpdate:modelValue":w[3]||(w[3]=u=>a.value.deliveryRange=u),modelModifiers:{number:!0},label:"Delivery Range",filled:"",type:"number",suffix:"meters",class:"q-mt-sm",rules:[u=>u>0||"Range must be greater than 0",u=>u<=1e4||"Maximum range is 10km (10000 meters)"]},null,8,["modelValue","rules"])])):j("",!0),o("div",Pa,[e(D,{label:"Save Settings",color:"primary",loading:c.value,onClick:R},null,8,["loading"])])]),_:1})]),_:1})]),o("div",La,[e(ee,{flat:"",bordered:""},{default:n(()=>[e(J,null,{default:n(()=>[o("div",Ea,[w[13]||(w[13]=o("div",{class:"text-subtitle1"},"Catalog Items",-1)),e(Ne),e(D,{color:"primary",icon:"add",label:"Add Item",onClick:w[4]||(w[4]=u=>H())})]),o("div",Ua,[e($e,{separator:""},{default:n(()=>[(C(!0),O(we,null,Se(a.value.catalogItems,u=>(C(),M(ie,{key:u.id,class:"q-py-md"},{default:n(()=>[e(Z,{avatar:""},{default:n(()=>[e(Pe,{src:u.imageUrl?Le+u.imageUrl:"",style:{width:"100px",height:"100px"},fit:"cover",class:"cursor-pointer",onClick:k=>b(u.imageUrl)},null,8,["src","onClick"])]),_:2},1024),e(Z,null,{default:n(()=>[e(ae,null,{default:n(()=>[Y($(u.title),1)]),_:2},1024),e(ae,{caption:""},{default:n(()=>[Y("Sequence: "+$(u.sequence),1)]),_:2},1024)]),_:2},1024),e(Z,{side:""},{default:n(()=>[o("div",Oa,[e(D,{flat:"",round:"",color:"primary",icon:"edit",onClick:k=>H(u)},null,8,["onClick"]),e(D,{flat:"",round:"",color:"negative",icon:"delete",onClick:k=>X(u)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1})])])]),_:1})]),_:1}),e(qe,{modelValue:P.value,"onUpdate:modelValue":w[8]||(w[8]=u=>P.value=u),persistent:""},{default:n(()=>[e(ee,{style:{"min-width":"350px"}},{default:n(()=>[e(J,null,{default:n(()=>[o("div",Da,$(r.value?"Edit":"Add")+" Item",1)]),_:1}),e(J,null,{default:n(()=>[e(te,{modelValue:A.value.title,"onUpdate:modelValue":w[5]||(w[5]=u=>A.value.title=u),label:"Title",filled:"",rules:[u=>!!u||"Title is required"]},null,8,["modelValue","rules"]),o("div",Fa,[l.value?(C(),O("div",Ba,[e(Pe,{src:l.value,class:"preview-image",fit:"contain"},null,8,["src"])])):j("",!0),e(Lo,{modelValue:U.value,"onUpdate:modelValue":[w[6]||(w[6]=u=>U.value=u),z],label:"Upload Image",filled:"",accept:"image/*",rules:[u=>!!u||"Image is required"]},{prepend:n(()=>[e(ue,{name:"attach_file"})]),_:1},8,["modelValue","rules"])]),e(te,{modelValue:A.value.sequence,"onUpdate:modelValue":w[7]||(w[7]=u=>A.value.sequence=u),modelModifiers:{number:!0},label:"Sequence",filled:"",type:"number",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),e(Me,{align:"right"},{default:n(()=>[se(e(D,{flat:"",label:"Cancel",color:"grey"},null,512),[[he]]),e(D,{label:r.value?"Save":"Add",color:"primary",loading:d.value,onClick:T},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(qe,{modelValue:_.value,"onUpdate:modelValue":w[9]||(w[9]=u=>_.value=u)},{default:n(()=>[e(ee,{class:"zoom-dialog"},{default:n(()=>[e(J,{class:"zoom-header"},{default:n(()=>[e(Ne),se(e(D,{icon:"close",flat:"",round:"",dense:"",color:"white",class:"zoom-close-btn"},null,512),[[he]])]),_:1}),e(J,{class:"q-pa-none"},{default:n(()=>[e(Pe,{src:s.value,style:{"max-height":"90vh"},fit:"contain"},null,8,["src"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model-value"]))}});var Ta=de(Ra,[["__scopeId","data-v-aa8d7a12"]]);const Ma={class:"business-info-container"},Qa={class:"text-h6 q-mb-sm q-px-md q-mt-md q-ma-none"},za={class:"q-px-md q-ma-none q-mb-sm"},Ha={class:"scrollable-inputs q-px-md q-pt-md"},ja={key:1,class:"input-fields"},Ga={class:"custom-input"},Wa={class:"custom-input"},Ya={class:"custom-input"},Ka={class:"custom-input"},Xa={class:"custom-input"},Ja={key:0,class:"text-caption q-mt-sm"},Za={class:"row q-col-gutter-sm"},es={class:"col-6"},os={class:"col-6"},ts={key:2,class:"contact-cards q-mt-md"},as={class:"col-auto q-pa-none q-ma-none"},ss={class:"col q-pl-sm"},ns={class:"text-subtitle2"},ls={class:"text-caption"},is={class:"text-caption"},rs={class:"col-12 q-mt-sm"},us={class:"col-auto"},cs=ne({__name:"BusinessInfo",props:{reloadComponents:{type:Function}},emits:["reloadComponents"],setup(y,{emit:F}){const p=le();I();const x=I(!1);I(!1);const c=ce(),P=I(!1),d=I(!1),r=I(!1);I(null);const A=y,U=F,l=Co({businessName:"",whatsappNumber:null,locationName:"",latitude:null,longitude:null,businessCategory:null}),B=v=>{if(v){const m=String(v).replace(/\D/g,"").trim();m.length>10?(l.whatsappNumber=Number(m.slice(0,10)),p.notify({type:"warning",message:"Phone number should be 10 digits",position:"top",timeout:2e3})):l.whatsappNumber=m?Number(m):null}else l.whatsappNumber=null},a=async()=>{if(!H.value){p.notify({type:"warning",message:"Please fill all required fields including location",position:"top-right"});return}const v=async()=>{var m,t,g,f,E;try{x.value=!0;const W={businessName:l.businessName,whatsappNumber:l.whatsappNumber,locationName:l.locationName,latitude:l.latitude,longitude:l.longitude,businessCategory:l.businessCategory},q=await K.post("/user/add-business-information",W);if(q.data){const S=[...((m=c.user)==null?void 0:m.locations)||[]],N=S.findIndex(L=>L.isBusinessLocation),Q={id:q.data.locationId,name:l.locationName,location:{type:"Point",coordinates:[l.longitude,l.latitude]},timestamp:null,isBusinessLocation:!0};N!==-1?S[N]=Q:S.push(Q),c.updateUser({...c.user,businessName:l.businessName,businessCategory:l.businessCategory||"",whatsappNumber:(t=l.whatsappNumber)==null?void 0:t.toString(),locations:S}),P.value=!1,h.value=!1,V(),p.notify({color:"black",message:"Business information saved successfully",position:"top-right"})}}catch(W){console.error("Error saving business info:",W);const q=W;p.notify({type:"negative",message:((f=(g=q.response)==null?void 0:g.data)==null?void 0:f.message)||"Failed to save business information",position:"top-right"})}finally{x.value=!1,(E=A.reloadComponents)==null||E.call(A),U("reloadComponents")}};l.whatsappNumber?await v():p.dialog({title:"WhatsApp Number Missing",message:"You are not submitting a WhatsApp number. You won't be able to be contacted. Do you still want to proceed?",cancel:!0,persistent:!0}).onOk(()=>{v()}).onCancel(()=>{})},V=()=>{l.businessName="",l.whatsappNumber=null,l.locationName="",l.latitude=null,l.longitude=null},R=()=>{const v=c.user;if(v){v.businessName&&(l.businessName=v.businessName),v.whatsappNumber&&(l.whatsappNumber=parseInt(v.whatsappNumber,10)),v.businessCategory&&(l.businessCategory=v.businessCategory);const m=v.locations;if(m&&m.length>0){const t=m.filter(g=>g.isBusinessLocation);if(t.length>0){const g=t[0];l.locationName=g.name,l.longitude=g.location.coordinates[0],l.latitude=g.location.coordinates[1]}}}};re(()=>{R()});const{t:z}=ge(),H=G(()=>l.businessName&&l.locationName&&l.latitude&&l.longitude),T=()=>{p.dialog({title:"Confirm Removal",message:"Are you sure you want to remove your business information?",cancel:!0,persistent:!0}).onOk(X)},X=async()=>{var v,m,t,g;try{x.value=!0,await K.delete("/user/remove-business-information"),l.businessName="",l.whatsappNumber=null,l.locationName="",l.latitude=null,l.longitude=null,c.updateUser({...c.user,businessName:null,whatsappNumber:null,locations:(((v=c.user)==null?void 0:v.locations)||[]).filter(f=>!f.isBusinessLocation)}),p.notify({color:"black",message:"Business information removed successfully",position:"top-right"}),(m=A.reloadComponents)==null||m.call(A),U("reloadComponents")}catch(f){const E=f;p.notify({type:"negative",message:((g=(t=E.response)==null?void 0:t.data)==null?void 0:g.message)||"Failed to remove business information",position:"top-right"})}finally{x.value=!1}},_=G(()=>{var v,m;return(m=(v=c.user)==null?void 0:v.locations)==null?void 0:m.find(t=>t.isBusinessLocation)}),s=v=>{v&&v.coordinates&&(l.latitude=v.coordinates[1],l.longitude=v.coordinates[0],d.value=!1)},b=()=>{r.value=!0},h=I(!1),w=(v=!1)=>{if(P.value=!0,h.value=v,v){const m=c.user;if(m){l.businessName=m.businessName||"",l.whatsappNumber=m.whatsappNumber?parseInt(m.whatsappNumber,10):null;const t=_.value;t&&(l.locationName=t.name,l.longitude=t.location.coordinates[0],l.latitude=t.location.coordinates[1])}}else l.businessName="",l.whatsappNumber=null,l.locationName="",l.latitude=null,l.longitude=null},u=G(()=>So.reduce((m,t,g)=>[...m,{group:t.group,id:`group_${g}`,value:`group_${g}`},...t.options.map((f,E)=>({...f,groupName:t.group,id:`${g}_${E}`}))],[])),k=(v,m)=>{if(v===""){m(()=>{});return}m(()=>{const t=v.toLowerCase(),g=u.value.filter(E=>{var W,q;return E.group?!0:((W=E.label)==null?void 0:W.toLowerCase().includes(t))||((q=E.groupName)==null?void 0:q.toLowerCase().includes(t))}),f=new Set(g.filter(E=>!E.group).map(E=>E.groupName));return g.filter(E=>!E.group||f.has(E.group))})};return(v,m)=>{var t,g;return C(),O("div",Ma,[o("h5",Qa,$(i(z)("common.businessInformation")),1),o("p",za,$(i(z)("common.businessLocationHelp")),1),o("div",Ha,[(t=i(c).user)!=null&&t.businessName?j("",!0):(C(),M(D,{key:0,icon:"add",color:"primary",class:"full-width custom-radius q-mb-md",onClick:m[0]||(m[0]=f=>w(!1)),label:"Add Business Information",style:{"border-radius":"10px !important"}})),P.value?(C(),O("div",ja,[o("div",Ga,[o("label",null,$(i(z)("common.businessName")),1),e(te,{modelValue:l.businessName,"onUpdate:modelValue":m[1]||(m[1]=f=>l.businessName=f),filled:"",class:"custom-radius","bg-color":"pink-1",dense:"","hide-bottom-space":"",rules:[f=>!!f||"Business name is required"]},null,8,["modelValue","rules"])]),o("div",Wa,[o("label",null,$(i(z)("common.whatsappNumber")),1),e(te,{modelValue:l.whatsappNumber,"onUpdate:modelValue":m[2]||(m[2]=f=>l.whatsappNumber=f),type:"number",filled:"",class:"custom-radius","bg-color":"pink-1",dense:"","hide-bottom-space":"",prefix:"+91",rules:[f=>!f||String(f).length===10||"Phone number must be 10 digits"],onInput:B,onKeydown:m[3]||(m[3]=f=>{l.whatsappNumber&&l.whatsappNumber.toString().length>=10&&f.key!=="Backspace"&&f.key!=="Delete"&&f.preventDefault()}),maxlength:"10"},null,8,["modelValue","rules"])]),o("div",Ya,[o("label",null,$(i(z)("common.businessCategory")),1),e(be,{modelValue:l.businessCategory,"onUpdate:modelValue":m[4]||(m[4]=f=>l.businessCategory=f),options:u.value,filled:"",class:"custom-radius","bg-color":"pink-1",dense:"","hide-bottom-space":"","option-value":"value","option-label":"label","map-options":"",filter:k,rules:[f=>!!f||"Business category is required"],"emit-value":""},{"no-option":n(()=>[e(ie,null,{default:n(()=>[e(Z,{class:"text-grey"},{default:n(()=>m[12]||(m[12]=[Y(" No results found ")])),_:1})]),_:1})]),option:n(f=>[f.opt.group?(C(),M(ae,{key:0,header:"",class:"text-weight-bold bg-grey-2 q-pa-sm"},{default:n(()=>[Y($(f.opt.group),1)]),_:2},1024)):(C(),M(ie,$o(wo({key:1},f.itemProps)),{default:n(()=>[e(Z,null,{default:n(()=>[e(ae,null,{default:n(()=>[Y($(f.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040))]),_:1},8,["modelValue","options","rules"])]),o("div",Ka,[o("label",null,$(i(z)("common.businessLocation")),1),e(te,{modelValue:l.locationName,"onUpdate:modelValue":m[5]||(m[5]=f=>l.locationName=f),filled:"",class:"custom-radius","bg-color":"pink-1",dense:"","hide-bottom-space":"",rules:[f=>!!f||"Location name is required"],placeholder:"e.g., Shop No. 123, Building Name"},null,8,["modelValue","rules"])]),o("div",Xa,[e(D,{flat:"",color:"white",style:{"border-radius":"10px !important"},icon:"my_location",class:"full-width custom-radius bg-primary",onClick:m[6]||(m[6]=f=>d.value=!0)},{default:n(()=>[Y($(i(z)("common.setLocation")),1)]),_:1}),l.latitude&&l.longitude?(C(),O("div",Ja,$(i(z)("common.coordinates"))+": "+$(l.latitude.toFixed(6))+", "+$(l.longitude.toFixed(6)),1)):j("",!0)]),o("div",Za,[o("div",es,[e(D,{label:(h.value,"Cancel"),color:"black",style:{"border-radius":"10px !important"},class:"full-width custom-radius",onClick:m[7]||(m[7]=f=>(P.value=!1,h.value=!1))},null,8,["label"])]),o("div",os,[e(D,{label:h.value?"Update":"Add",color:"primary",style:{"border-radius":"10px !important"},class:"full-width custom-radius",onClick:a,disabled:!H.value,loading:x.value},null,8,["label","disabled","loading"])])])])):j("",!0),!h.value&&((g=i(c).user)==null?void 0:g.businessName)?(C(),O("div",ts,[e(ee,{flat:"",bordered:"",class:"contact-card q-mb-sm"},{default:n(()=>[e(J,{class:"row items-center",style:{width:"100%"}},{default:n(()=>{var f,E,W,q;return[o("div",as,[e(Ue,{class:"q-pa-none q-ma-none"},{default:n(()=>m[13]||(m[13]=[o("img",{src:"/my-business.png",alt:"business-icon",style:{width:"80%",height:"100%","object-fit":"contain"}},null,-1)])),_:1})]),o("div",ss,[o("div",ns,$((f=i(c).user)==null?void 0:f.businessName),1),o("div",ls," WhatsApp: +91 "+$((E=i(c).user)==null?void 0:E.whatsappNumber),1),o("div",is," Address: "+$((W=_.value)==null?void 0:W.name),1),o("div",rs,[e(D,{class:"manage-catalog-btn full-width",label:(q=i(c).user)!=null&&q.hasCatalog?"Manage Catalog":"Setup Catalog",style:{"border-radius":"10px !important"},color:"primary",onClick:b},{default:n(()=>{var S;return[e(ue,{name:(S=i(c).user)!=null&&S.hasCatalog?"inventory_2":"add_business",class:"q-mx-sm"},null,8,["name"])]}),_:1},8,["label"])]),o("div",us,[e(D,{flat:"",icon:"edit",color:"primary",class:"edit-btn",style:{"border-radius":"10px !important"},onClick:m[8]||(m[8]=S=>w(!0))}),e(D,{class:"remove-btn",flat:"",icon:"delete",color:"grey-7",style:{"border-radius":"10px !important"},onClick:T})])])]}),_:1})]),_:1})])):j("",!0)]),e(Be,{modelValue:d.value,"onUpdate:modelValue":[m[9]||(m[9]=f=>d.value=f),m[10]||(m[10]=f=>d.value=f)],onLocationSelected:s},null,8,["modelValue"]),e(Ta,{modelValue:r.value,"onUpdate:modelValue":m[11]||(m[11]=f=>r.value=f)},null,8,["modelValue"])])}}});var ds=de(cs,[["__scopeId","data-v-ec73e06e"]]);const ms={class:"profile-header"},ps={key:0,class:"profile-content"},vs={class:"profile-main"},gs={class:"profile-image-container"},fs={class:"profile-image"},ys=["src"],bs={key:1,src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS59s6qBOFlkS5LN4Z0U3G71nCWWg3SuHGVMw&s"},hs={style:{"margin-left":"138px","margin-top":"-175px"}},_s={class:"profile-info-container"},Cs={class:"profile-text"},$s={class:"profile-name q-ma-none text-capitalize"},ws={class:"main-content"},Ss={class:"expansion-container"},ks={class:"text-center text-subtitle1 versiontextcolor text-weight-thin",style:{"font-weight":"600"}},xs={style:{"font-size":"13px"}},Vs={class:"text-center text-subtitle1 text-weight-light pa-md"},qs={href:"mailto:care@sosbharat.com",class:"report-link",style:{"font-size":"13px"}},Is={class:"logout-section q-pb-md"},As=ne({__name:"ProfileTabs",setup(y){var X;const F=I(null),p=I(!1),{t:x}=ge(),c=ce(),P=Te(),d=le(),r=I(0),A=()=>{console.log("reloadKey......",r),r.value++},{values:U,validateAndSubmit:l,callbacks:B}=Eo("qnatk/User/actionExecuteWithFiles/profileChange/true",{url:null,userId:c.user.id,referralId:c.user.referralId});B.onSuccess=_=>{console.log("data..........",_),c.updateUser({profileImage:_.profileImage})};const a=()=>{F.value&&F.value.click()},V=async _=>{var b;p.value=!0;const s=(b=_.target.files)==null?void 0:b[0];if(s)try{if(!s.type.match(/^image\/(jpeg|png|gif|webp|heic|heif)$/)){d.notify({color:"negative",message:"Only image files are allowed",icon:"error",position:"top-right"}),p.value=!1;return}const h=await R(s),w=new File([h],s.name,{type:s.type});U.value.url=w,await l()}catch{d.notify({color:"negative",message:"Error processing images",icon:"error",position:"top-right"})}finally{p.value=!1}},R=_=>new Promise((s,b)=>{const h=new FileReader;h.onload=w=>{var k;const u=new Image;u.onload=()=>{const v=document.createElement("canvas");let m=u.width,t=u.height;const g=m/t,f=1048576,E=1920,W=1080;m>E&&(m=E,t=m/g),t>W&&(t=W,m=t*g),v.width=m,v.height=t;const q=v.getContext("2d");q.imageSmoothingEnabled=!0,q.imageSmoothingQuality="high",q.drawImage(u,0,0,m,t);let S=.7;const N=Q=>{v.toBlob(L=>{if(!L){b(new Error("Failed to create blob"));return}console.log(`Compressed image size: ${L.size} bytes`),L.size>f&&Q>.1?N(Q-.1):s(L)},"image/jpeg",Q)};N(S)},u.onerror=()=>b(new Error("Failed to load image")),u.src=(k=w.target)==null?void 0:k.result},h.onerror=()=>b(new Error("Failed to read file")),h.readAsDataURL(_)}),z=G(()=>d.platform.is.ios?Ao:d.platform.is.android?No:Po),H=async()=>{try{await K.post("/auth/logout"),c.logout(),P.push("/login")}catch(_){console.error("Error logging out",_)}},T=I({profile:!((X=c.user)!=null&&X.name),volunteers:!1,myPosts:!1,community:!1,feedback:!1,rating:!1,settings:!1,emergencyContact:!1,business:!1});return(_,s)=>(C(),O("div",{class:"profile-container",key:r.value},[o("div",ms,[s[12]||(s[12]=o("div",{class:"cover-image"},[o("img",{src:"https://img.freepik.com/premium-vector/line-drawing-children-holding-hands_904506-140.jpg?w=826",alt:"Cover",class:"cover-img"}),o("div",{class:"overlay"})],-1)),i(c).user.name?(C(),O("div",ps,[o("div",vs,[o("div",gs,[o("div",fs,[i(c).user.profileImage?(C(),O("img",{key:0,src:"https://xavoc-technocrats-pvt-ltd.blr1.cdn.digitaloceanspaces.com/"+i(c).user.profileImage},null,8,ys)):(C(),O("img",bs)),o("div",hs,[e(D,{round:"",size:"sm",style:{"background-color":"rgba(0, 0, 0, 0.2)"},onClick:a,loading:p.value},{default:n(()=>[e(ue,{class:"text-white",name:"edit"})]),_:1},8,["loading"]),o("input",{ref_key:"fileInput",ref:F,type:"file",style:{display:"none"},onChange:V},null,544)]),s[9]||(s[9]=o("div",{class:"online-status"},null,-1))]),i(d).screen.lg||i(d).screen.xl||i(d).screen.md?(C(),M(D,{key:0,flat:"",onClick:s[0]||(s[0]=b=>i(P).push(`/my-posts/${i(c).user.id}`)),class:"text-center my-posts-btn1"},{default:n(()=>s[10]||(s[10]=[o("span",{style:{"font-size":"13px"}}," My Posts ",-1)])),_:1})):j("",!0)]),o("div",_s,[o("div",Cs,[o("h2",$s,$(i(c).user.name),1)]),i(d).screen.sm||i(d).screen.xs?(C(),M(D,{key:0,flat:"",onClick:s[1]||(s[1]=b=>i(P).push(`/my-posts/${i(c).user.id}`)),class:"text-center my-posts-btn"},{default:n(()=>s[11]||(s[11]=[o("span",{style:{"font-size":"13px"}}," My Posts ",-1)])),_:1})):j("",!0)])])])):j("",!0)]),o("div",ws,[o("div",Ss,[e($e,{separator:""},{default:n(()=>[se((C(),M(pe,{modelValue:T.value.profile,"onUpdate:modelValue":s[2]||(s[2]=b=>T.value.profile=b),group:"profile-tabs",icon:"person",label:i(x)("common.myProfile"),"header-class":"glass-effect"},{default:n(()=>[e(ee,null,{default:n(()=>[e(Xo,{"reload-components":A})]),_:1})]),_:1},8,["modelValue","label"])),[[_e]]),i(c).user.name?(C(),M(pe,{key:0,modelValue:T.value.emergencyContact,"onUpdate:modelValue":s[3]||(s[3]=b=>T.value.emergencyContact=b),group:"profile-tabs",icon:"mdi-human-greeting-proximity",label:i(x)("common.emergencyContact")},{default:n(()=>[e(xa,{"reload-components":A})]),_:1},8,["modelValue","label"])):j("",!0),i(c).user.name?(C(),M(pe,{key:1,modelValue:T.value.volunteers,"onUpdate:modelValue":s[4]||(s[4]=b=>T.value.volunteers=b),group:"profile-tabs",icon:"volunteer_activism",label:i(x)("common.beVolunteers")},{default:n(()=>[e(ee,null,{default:n(()=>[e(ht,{onReloadComponents:A})]),_:1})]),_:1},8,["modelValue","label"])):j("",!0),i(c).user.name?(C(),M(pe,{key:2,modelValue:T.value.community,"onUpdate:modelValue":s[5]||(s[5]=b=>T.value.community=b),group:"profile-tabs",icon:"people",label:i(x)("common.communityImpact")},{default:n(()=>[e(ea,{"reload-components":A})]),_:1},8,["modelValue","label"])):j("",!0),i(c).user.name?(C(),M(pe,{key:3,modelValue:T.value.feedback,"onUpdate:modelValue":s[6]||(s[6]=b=>T.value.feedback=b),group:"profile-tabs",icon:"fas fa-history",label:i(x)("common.sosHistory")},{default:n(()=>[e(Rt,{"reload-components":A})]),_:1},8,["modelValue","label"])):j("",!0),i(c).user.name?(C(),M(pe,{key:4,modelValue:T.value.settings,"onUpdate:modelValue":s[7]||(s[7]=b=>T.value.settings=b),group:"profile-tabs",icon:"mdi-cog",label:i(x)("common.sosSetting")},{default:n(()=>[e(aa,{"reload-components":A})]),_:1},8,["modelValue","label"])):j("",!0),i(c).user.name?(C(),M(pe,{key:5,modelValue:T.value.business,"onUpdate:modelValue":s[8]||(s[8]=b=>T.value.business=b),group:"profile-tabs",icon:"mdi-google-my-business",label:i(x)("common.businessInfo")},{default:n(()=>[e(ds,{"reload-components":A})]),_:1},8,["modelValue","label"])):j("",!0)]),_:1})]),e(Ce,{size:"20",class:"q-mt-lg"}),o("div",ks,[s[13]||(s[13]=o("span",{style:{"font-size":"13px"}},"App version : ",-1)),o("span",xs,$(z.value),1)]),o("div",Vs,[o("a",qs,[Y($(i(x)("common.caretext")),1),s[14]||(s[14]=o("br",null,null,-1)),s[15]||(s[15]=Y(" care@sosbharat.com "))])]),o("div",Is,[e(D,{style:{width:"90%",margin:"auto"},label:"Logout",onClick:H,class:"logout-btn",icon:"logout"})])])]))}});var Bs=de(As,[["__scopeId","data-v-22af8dc7"]]);export{Bs as default};
