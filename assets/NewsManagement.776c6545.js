import{z as ne,A as oe,r,e as se,B as ie,D as w,R as T,S as o,V as c,T as t,al as V,aM as ue,Y as d,an as y,bD as re,E as U,au as P,at as B,aN as de,ap as I,X as q,ao as D,as as ce,ae as ge,W as me,ag as M,aJ as j,ar as ve,a3 as pe,F as m,bm as fe,aq as O,af as we,aj as R,ai as G,$ as z}from"./index.168e4218.js";import{a as ye,Q as $}from"./QTable.54c001c1.js";import{Q as be}from"./QFile.d1cd6fbd.js";import{Q as H}from"./QForm.5b8ff544.js";const Ve={class:"row q-col-gutter-md"},Ce={class:"col-12"},Ne={key:1},Se={class:"text-h6"},he={class:"row justify-end q-gutter-sm"},Te={class:"q-mb-md"},xe={class:"row items-center"},Le={class:"row justify-end q-gutter-sm"},qe=ne({__name:"NewsManagement",setup(Qe){const s=oe(),g=r(!1),S=r(!1),h=r(!1),v=r(!1),E=r([]),x=r([]),C=r(!1),L=r(!1),Q=r(new Date().toISOString().split("T")[0]),k=[{label:"English",value:"en"},{label:"Hindi",value:"hi"},{label:"Bengali",value:"bn"},{label:"Tamil",value:"ta"},{label:"Telugu",value:"te"},{label:"Gujarati",value:"gu"},{label:"Marathi",value:"mr"},{label:"Urdu",value:"ur"},{label:"Malayalam",value:"ml"},{label:"Kannada",value:"kn"}],F=[{label:"Politics",value:"politics"},{label:"Business",value:"business"},{label:"Technology",value:"technology"},{label:"Science",value:"science"},{label:"Health",value:"health"},{label:"Sports",value:"sports"},{label:"Entertainment",value:"entertainment"},{label:"Education",value:"education"},{label:"Local News",value:"local_news"},{label:"Crime",value:"crime"},{label:"Environment",value:"environment"},{label:"Culture",value:"culture"},{label:"Lifestyle",value:"lifestyle"},{label:"Economy",value:"economy"}],J=[{name:"id",label:"ID",field:"id"},{name:"image",label:"Image",field:"mediaUrls",format:a=>(a==null?void 0:a[0])||"",style:"width: 150px"},{name:"title",label:"Title",field:"title"},{name:"defaultLanguage",label:"Default Language",field:"defaultLanguage"},{name:"categories",label:"Categories",field:"categories",format:a=>(Array.isArray(a)?a:[]).map(e=>{var u;return(u=F.find(b=>b.value===e))==null?void 0:u.label}).filter(Boolean).join(", ")},{name:"status",label:"Status",field:"status"},{name:"isIndianNews",label:"News Type",field:"isIndianNews",format:a=>a?"Indian News":"International News"},{name:"actions",label:"Actions",field:"actions"},{name:"translations",label:"Available Translations",field:"translations",format:a=>(a==null?void 0:a.map(l=>l.languageCode).join(", "))||"-"}],p=r({page:1,rowsPerPage:10,rowsNumber:0}),n=r({id:null,title:"",content:"",defaultLanguage:"en",mediaFiles:[],categories:[],source:"",isIndianNews:!0,imageSource:""}),i=r({newsId:null,languageCode:"",title:"",content:""});async function f(){try{g.value=!0;const a=await m.get("/news/news",{params:{page:p.value.page,pageSize:p.value.rowsPerPage}});E.value=a.data.items,p.value.rowsNumber=a.data.total}catch{s.notify({color:"negative",message:"Failed to load news",position:"top-right"})}finally{g.value=!1}}function A(a=null){a?(v.value=!0,n.value={...a,categories:Array.isArray(a.categories)?a.categories:[],mediaFiles:[],source:a.source||"",isIndianNews:a.isIndianNews,imageSource:a.imageSource||""}):(v.value=!1,n.value={id:null,title:"",content:"",defaultLanguage:"en",mediaFiles:[],categories:[],source:"",isIndianNews:!0,imageSource:""}),S.value=!0}function K(a){x.value=a.translations||[],C.value=!1,i.value={id:null,newsId:a.id,languageCode:"",title:"",content:""},h.value=!0}async function W(){try{g.value=!0;const a=new FormData,l=Array.isArray(n.value.categories)?n.value.categories:[];v.value&&n.value.id&&a.append("id",n.value.id.toString()),a.append("title",n.value.title),a.append("content",n.value.content),a.append("defaultLanguage",n.value.defaultLanguage),a.append("categories",JSON.stringify(l)),a.append("source",n.value.source||""),a.append("isIndianNews",n.value.isIndianNews.toString()),a.append("imageSource",n.value.imageSource||""),n.value.mediaFiles&&n.value.mediaFiles.forEach(e=>{a.append("files",e)}),v.value?await m.put(`/news/update-news/${n.value.id}`,a):await m.post("/news/create-news",a),S.value=!1,await f(),s.notify({color:"black",message:`News ${v.value?"updated":"created"} successfully`,position:"top-right"})}catch(a){console.error("Save news error:",a),s.notify({color:"negative",message:"Failed to save news",position:"top-right"})}finally{g.value=!1}}async function X(){try{g.value=!0,C.value?await m.put(`/news/translations/${i.value.id}`,i.value):await m.post("/news/translations",i.value),h.value=!1,await f(),s.notify({color:"positive",message:`Translation ${C.value?"updated":"saved"} successfully`})}catch{s.notify({color:"negative",message:"Failed to save translation"})}finally{g.value=!1}}async function Y(a){try{s.dialog({title:"Confirm",message:"Are you sure you want to delete this news?",cancel:!0,persistent:!0}).onOk(async()=>{try{g.value=!0,await m.delete(`/news/${a.id}`),await f(),s.notify({color:"positive",message:"News deleted successfully"})}catch{s.notify({color:"negative",message:"Failed to delete news"})}finally{g.value=!1}}).onCancel(()=>{console.log("cancelled")})}catch{s.notify({color:"negative",message:"Failed to show delete confirmation"})}}function Z(a){p.value.page=a.pagination.page,p.value.rowsPerPage=a.pagination.rowsPerPage,f()}function _(a){var l;return((l=k.find(e=>e.value===a))==null?void 0:l.label)||a}function ee(a){C.value=!0,i.value={id:a.id,newsId:a.newsId,languageCode:a.languageCode,title:a.title,content:a.content}}async function ae(a){try{await s.dialog({title:"Confirm Deletion",message:"Are you sure you want to delete this translation?",cancel:!0,persistent:!0}).onOk(async()=>{await m.delete(`/news/translations/${a.id}`),await f(),s.notify({color:"positive",message:"Translation deleted successfully"})})}catch(l){l&&s.notify({color:"negative",message:"Failed to delete translation"})}}const le=se(()=>{const a=new Set(x.value.map(l=>l.languageCode));return k.filter(l=>!a.has(l.value)||l.value===i.value.languageCode)});async function te(){var a,l;try{L.value=!0;const e={business:"business",entertainment:"entertainment",health:"health",science:"science",sports:"sports",technology:"technology",general:"general"},u=F.map(N=>N.value).filter(N=>N in e).map(N=>e[N]),b=await m.post("/news/fetch-external",{categories:u,languages:["en"],date:Q.value});s.notify({color:"positive",message:`Successfully imported ${b.data.saved} news articles (${b.data.indianNews} Indian, ${b.data.globalNews} Global) out of ${b.data.total}`}),await f()}catch(e){console.error("Error fetching external news:",e),s.notify({color:"negative",message:"Failed to fetch external news: "+(((l=(a=e.response)==null?void 0:a.data)==null?void 0:l.message)||e.message)})}finally{L.value=!1}}return ie(()=>{f()}),(a,l)=>(w(),T(pe,{padding:""},{default:o(()=>[c("div",Ve,[c("div",Ce,[t(I,null,{default:o(()=>[t(V,{class:"row items-center"},{default:o(()=>[l[16]||(l[16]=c("div",{class:"text-h6"},"News Management",-1)),t(ue),t(d,{color:"primary",label:"Add News",onClick:l[0]||(l[0]=e=>A())}),t(y,{modelValue:Q.value,"onUpdate:modelValue":l[1]||(l[1]=e=>Q.value=e),type:"date",label:"Fetch news for date",class:"q-mx-sm",style:{width:"200px"}},null,8,["modelValue"]),t(d,{color:"secondary",label:"Fetch External News",class:"q-ml-sm",loading:L.value,onClick:te},null,8,["loading"])]),_:1}),t(V,null,{default:o(()=>[t(ye,{rows:E.value,columns:J,"row-key":"id",loading:g.value,pagination:p.value,"onUpdate:pagination":l[2]||(l[2]=e=>p.value=e),onRequest:Z},{"body-cell-actions":o(e=>[t($,{props:e},{default:o(()=>[t(re,{flat:""},{default:o(()=>[t(d,{flat:"",round:"",color:"primary",icon:"translate",onClick:u=>K(e.row)},null,8,["onClick"]),t(d,{flat:"",round:"",color:"primary",icon:"edit",onClick:u=>A(e.row)},null,8,["onClick"]),t(d,{flat:"",round:"",color:"negative",icon:"delete",onClick:u=>Y(e.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-translations":o(e=>[t($,{props:e},{default:o(()=>[(w(!0),U(B,null,P(e.row.translations,u=>(w(),T(fe,{key:u.id,label:_(u.languageCode),class:"q-ma-xs"},null,8,["label"]))),128))]),_:2},1032,["props"])]),"body-cell-image":o(e=>[t($,{props:e},{default:o(()=>[e.value?(w(),T(de,{key:0,src:e.value,style:{height:"50px","max-width":"100px"},fit:"cover"},null,8,["src"])):(w(),U("span",Ne,"No image"))]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1})])]),t(j,{modelValue:S.value,"onUpdate:modelValue":l[11]||(l[11]=e=>S.value=e),persistent:""},{default:o(()=>[t(I,{style:{"min-width":"500px"}},{default:o(()=>[t(V,null,{default:o(()=>[c("div",Se,q(v.value?"Edit News":"Add News"),1)]),_:1}),t(V,null,{default:o(()=>[t(H,{onSubmit:W,class:"q-gutter-md"},{default:o(()=>[t(D,{modelValue:n.value.defaultLanguage,"onUpdate:modelValue":l[3]||(l[3]=e=>n.value.defaultLanguage=e),options:k,label:"Default Language","emit-value":"","map-options":"",rules:[e=>!!e||"Language is required"]},null,8,["modelValue","rules"]),t(D,{modelValue:n.value.categories,"onUpdate:modelValue":l[4]||(l[4]=e=>n.value.categories=e),options:F,label:"Categories","emit-value":"","map-options":"",multiple:"","use-chips":"",clearable:"",rules:[e=>e.length>0||"At least one category is required"]},null,8,["modelValue","rules"]),t(y,{modelValue:n.value.title,"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.title=e),label:"Title",rules:[e=>!!e||"Title is required"]},null,8,["modelValue","rules"]),t(y,{modelValue:n.value.content,"onUpdate:modelValue":l[6]||(l[6]=e=>n.value.content=e),type:"textarea",label:"Content",rules:[e=>!!e||"Content is required"]},null,8,["modelValue","rules"]),t(y,{modelValue:n.value.source,"onUpdate:modelValue":l[7]||(l[7]=e=>n.value.source=e),label:"Source URL",type:"url",hint:"Enter the source URL of the news (optional)"},null,8,["modelValue"]),t(ce,{modelValue:n.value.isIndianNews,"onUpdate:modelValue":l[8]||(l[8]=e=>n.value.isIndianNews=e),label:"Is Indian News",color:"primary"},null,8,["modelValue"]),t(y,{modelValue:n.value.imageSource,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value.imageSource=e),label:"Image Source URL",type:"url",hint:"Enter direct image URL (optional)"},null,8,["modelValue"]),t(ge,{class:"q-my-md"}),t(be,{modelValue:n.value.mediaFiles,"onUpdate:modelValue":l[10]||(l[10]=e=>n.value.mediaFiles=e),label:"Media Files",multiple:"",accept:"image/*,video/*"},{append:o(()=>[t(me,{name:"attach_file"})]),_:1},8,["modelValue"]),c("div",he,[M(t(d,{label:"Cancel",color:"grey"},null,512),[[O]]),t(d,{type:"submit",color:"primary",label:v.value?"Update":"Save"},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(j,{modelValue:h.value,"onUpdate:modelValue":l[15]||(l[15]=e=>h.value=e),persistent:""},{default:o(()=>[t(I,{style:{"min-width":"500px"}},{default:o(()=>[t(V,null,{default:o(()=>l[17]||(l[17]=[c("div",{class:"text-h6"},"Manage Translations",-1)])),_:1}),t(V,null,{default:o(()=>[c("div",Te,[l[18]||(l[18]=c("div",{class:"text-subtitle2 q-mb-sm"},"Existing Translations",-1)),t(ve,{bordered:"",separator:""},{default:o(()=>[(w(!0),U(B,null,P(x.value,e=>(w(),T(we,{key:e.id},{default:o(()=>[t(R,null,{default:o(()=>[t(G,null,{default:o(()=>[z(q(_(e.languageCode)),1)]),_:2},1024),t(G,{caption:""},{default:o(()=>[z(q(e.title),1)]),_:2},1024)]),_:2},1024),t(R,{side:""},{default:o(()=>[c("div",xe,[t(d,{flat:"",round:"",color:"primary",icon:"edit",onClick:u=>ee(e)},null,8,["onClick"]),t(d,{flat:"",round:"",color:"negative",icon:"delete",onClick:u=>ae(e)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),t(H,{onSubmit:X,class:"q-gutter-md"},{default:o(()=>[t(D,{modelValue:i.value.languageCode,"onUpdate:modelValue":l[12]||(l[12]=e=>i.value.languageCode=e),options:le.value,label:"Language","emit-value":"","map-options":"",rules:[e=>!!e||"Language is required"]},null,8,["modelValue","options","rules"]),t(y,{modelValue:i.value.title,"onUpdate:modelValue":l[13]||(l[13]=e=>i.value.title=e),label:"Title",rules:[e=>!!e||"Title is required"]},null,8,["modelValue","rules"]),t(y,{modelValue:i.value.content,"onUpdate:modelValue":l[14]||(l[14]=e=>i.value.content=e),type:"textarea",label:"Content",rules:[e=>!!e||"Content is required"]},null,8,["modelValue","rules"]),c("div",Le,[M(t(d,{label:"Cancel",color:"grey"},null,512),[[O]]),t(d,{type:"submit",color:"primary",label:C.value?"Update Translation":"Add Translation"},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{qe as default};
