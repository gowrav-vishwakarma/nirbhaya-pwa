import{G as D,z as N,u as P,A as B,r as d,e as I,B as M,D as p,R as A,S as n,T as o,al as V,V as f,X as L,an as v,W as j,E as y,at as G,au as z,a0 as O,ao as _,Y as c,as as R,ap as W,bD as X,a3 as Y,F as b,aN as H}from"./index.168e4218.js";import{Q as J}from"./QFile.d1cd6fbd.js";import{Q as K}from"./QForm.5b8ff544.js";import{Q as Z,a as ee}from"./QTable.54c001c1.js";const ae={class:"text-h6"},le={key:0,class:"row q-gutter-sm"},te={class:"absolute-top-right q-pa-xs"},oe={class:"row justify-end q-gutter-sm"},ne=N({__name:"CommunityFeedCrud",setup(se){const U=P(),s=B(),u=d(!1),i=d(!1),C=d([]);d();const e=d({id:null,title:"",content:"",mediaUrls:[],mediaFiles:[],uploadedUrls:[],category:"general",tags:[],location:null,locations:[],isEmergency:!1}),k=[{name:"id",label:"ID",field:"id"},{name:"title",label:"Title",field:"title"},{name:"category",label:"Category",field:"category"},{name:"isEmergency",label:"Emergency",field:"isEmergency"},{name:"likesCount",label:"Likes",field:"likesCount"},{name:"commentsCount",label:"Comments",field:"commentsCount"},{name:"status",label:"Status",field:"status"},{name:"actions",label:"Actions",field:"actions"}];I(()=>{if(!e.value.location)return"";const l=e.value.location.coordinates;return`${l[0]}, ${l[1]}`});const m=d({page:1,rowsPerPage:10,rowsNumber:0});async function w(){try{u.value=!0;const l=await b.get("/news/news",{params:{page:m.value.page,limit:m.value.rowsPerPage}});C.value=l.data,m.value.rowsNumber=l.data.length}catch{s.notify({color:"negative",message:"Failed to load feeds",position:"top-right"})}finally{u.value=!1}}async function Q(){try{u.value=!0;const l=await h(e.value.mediaFiles),t={...e.value,userId:U.user.id};Object.keys(t).forEach(g=>{g!=="mediaFiles"&&l.append(g,t[g])});const a=i.value?`/api/community-feeds/${e.value.id}`:"/news/create-news",r=i.value?"put":"post";await b[r](a,l,{headers:{"Content-Type":"multipart/form-data"}});const F=i.value?"Feed updated successfully":"Feed created successfully";s.notify({color:"positive",message:F,position:"top-right"})}catch{s.notify({color:"negative",message:"Failed to create or update feed",position:"top-right"})}finally{u.value=!1}}async function h(l){const t=new FormData;return Array.from(l).forEach(a=>t.append("files",a)),t}function E(l){i.value=!0,e.value={...e.value,...l,mediaFiles:[],mediaUrls:l.mediaUrls||[]}}async function T(l){try{await s.dialog({title:"Confirm",message:"Are you sure you want to delete this feed?",cancel:!0}),await b.delete(`/api/community-feeds/${l}`),s.notify({color:"black",message:"Feed deleted successfully",position:"top-right"}),await w()}catch(t){t&&s.notify({color:"negative",message:"Delete operation failed",position:"top-right"})}}async function $(){try{const l=await new Promise((t,a)=>{navigator.geolocation.getCurrentPosition(t,a)});e.value.location={type:"Point",coordinates:[l.coords.longitude,l.coords.latitude]}}catch{s.notify({color:"negative",message:"Failed to get location",position:"top-right"})}}function x(l,t){l.length>0&&(e.value.tags.includes(l)||e.value.tags.push(l),t(l))}function S(){i.value=!1,e.value={id:null,title:"",content:"",mediaUrls:[],mediaFiles:[],uploadedUrls:[],category:"general",tags:[],location:null,locations:[],isEmergency:!1}}function q(l){e.value.mediaUrls.splice(l,1),e.value.mediaFiles.splice(l,1)}return M(()=>{w()}),(l,t)=>(p(),A(Y,{padding:""},{default:n(()=>[o(W,{class:"q-mb-md"},{default:n(()=>[o(V,null,{default:n(()=>[f("div",ae,L(i.value?"Edit Feed":"Add New Feed"),1)]),_:1}),o(V,null,{default:n(()=>[o(K,{onSubmit:Q,class:"q-gutter-md"},{default:n(()=>[o(v,{modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.title=a),label:"Title",rules:[a=>!!a||"Title is required"]},null,8,["modelValue","rules"]),o(v,{modelValue:e.value.content,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.content=a),type:"textarea",label:"Content",rules:[a=>!!a||"Content is required"]},null,8,["modelValue","rules"]),o(J,{modelValue:e.value.mediaFiles,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.mediaFiles=a),label:"Media Files",multiple:"",accept:"image/*,video/*",loading:u.value},{append:n(()=>[o(j,{name:"attach_file"})]),_:1},8,["modelValue","loading"]),e.value.mediaUrls.length?(p(),y("div",le,[(p(!0),y(G,null,z(e.value.mediaUrls,(a,r)=>(p(),y("div",{key:r,class:"col-auto"},[o(H,{src:a,style:{height:"140px",width:"140px","border-radius":"8px"}},{default:n(()=>[f("div",te,[o(c,{round:"",flat:"",dense:"",color:"negative",icon:"close",onClick:F=>q(r),class:"bg-grey-8 bg-opacity-50"},null,8,["onClick"])])]),_:2},1032,["src"])]))),128))])):O("",!0),o(_,{modelValue:e.value.category,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.category=a),options:["general","emergency","alert","news"],label:"Category"},null,8,["modelValue"]),o(_,{modelValue:e.value.tags,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.tags=a),multiple:"","use-input":"","use-chips":"","input-debounce":"0",label:"Tags",onNewValue:x},null,8,["modelValue"]),o(v,{modelValue:e.value.location,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value.location=a),label:"Location",readonly:"",value:e.value.location?`${e.value.location.coordinates[0]}, ${e.value.location.coordinates[1]}`:""},{append:n(()=>[o(c,{icon:"location_on",onClick:$})]),_:1},8,["modelValue","value"]),o(R,{modelValue:e.value.isEmergency,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value.isEmergency=a),label:"Mark as Emergency"},null,8,["modelValue"]),f("div",oe,[o(c,{type:"button",color:"grey",label:"Cancel",onClick:S}),o(c,{type:"submit",color:"primary",label:i.value?"Update":"Submit"},null,8,["label"])])]),_:1})]),_:1})]),_:1}),o(ee,{rows:C.value,columns:k,"row-key":"id",loading:u.value,pagination:m.value,"onUpdate:pagination":t[7]||(t[7]=a=>m.value=a)},{"body-cell-actions":n(a=>[o(Z,{props:a},{default:n(()=>[o(X,{flat:""},{default:n(()=>[o(c,{flat:"",round:"",color:"primary",icon:"edit",onClick:r=>E(a.row)},null,8,["onClick"]),o(c,{flat:"",round:"",color:"negative",icon:"delete",onClick:r=>T(a.row.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1}))}});var ce=D(ne,[["__scopeId","data-v-6b6113ea"]]);export{ce as default};
