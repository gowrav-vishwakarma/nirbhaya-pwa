import{G as Ve,z as Re,bn as Le,H as Me,u as ze,A as Ee,r as c,B as Ne,v as Be,e as B,w as W,M as Pe,D as n,R as P,S as m,U as Q,E as i,T as d,V as l,Y as X,a0 as S,bt as Qe,W as ae,at as x,au as I,ap as le,al as T,aM as Oe,aI as je,ag as H,aJ as Fe,a3 as We,F as ne,ax as Xe,X as _,$ as oe,bA as ie,a1 as re,am as J,az as He,aN as q,bB as Je,aq as Ge}from"./index.168e4218.js";const Ye={key:0,class:"row items-center",style:{"padding-top":"5px","padding-left":"10px"}},Ke={class:"container q-pa-md"},Ze={key:0,class:"row justify-center q-pa-md"},et={key:1,class:"row justify-center q-pa-xl"},tt={class:"text-center"},st={key:2,class:"row q-col-gutter-y-md",style:{"margin-top":"-30px"}},at={class:"row items-center"},lt={class:"q-ml-md"},nt={class:"text-weight-bold text-capitalize",style:{"font-size":"16px"}},ot={class:"text-caption text-grey-7"},it={class:"text-h5 text-weight-bold text-primary q-mb-sm",style:{"font-size":"16px"}},rt={class:"text-body1 post-description"},ut=["onClick"],ct={key:0,class:"hashtags-container"},dt=["onClick"],vt={key:0,class:"video-container"},mt=["src","id"],gt={key:1,class:"media-section"},ft={class:"carousel-dots"},yt=["onClick"],ht={class:"carousel-counter"},pt={key:1,class:"media-collage"},wt={key:1,class:"two-images-grid"},_t={key:2,class:"multi-images-grid"},bt={class:"main-image-container"},kt={class:"secondary-images-container"},xt={key:0,class:"see-all-overlay"},Ut={class:"text-white text-weight-bold"},b="https://xavoc-technocrats-pvt-ltd.blr1.cdn.digitaloceanspaces.com/",Ct=Re({__name:"CommunityPostOpenRoute",setup(St){const G=Le(),A=Me(),V=ze(),Y=Ee(),v=c([]),K=c(),R=c({}),Z=c({}),ee=c(!0),h=c(null),L=c(!1),ue=c(0),ce=()=>{console.log("checkAndShowLoginDialog",V.isLoggedIn),V.isLoggedIn||(L.value=!0)},de=t=>{if(console.log("date.......",t),!t)return"Recent";try{const e=new Date(t);if(isNaN(e.getTime()))return"Invalid date";const r=new Date().getTime()-e.getTime(),a=Math.floor(r/1e3),o=Math.floor(a/60),y=Math.floor(o/60),C=Math.floor(y/24);if(a<60)return"Just now";if(o<60)return`${o} ${o===1?"minute":"minutes"} ago`;if(y<24)return`${y} ${y===1?"hour":"hours"} ago`;if(C<7)return`${C} ${C===1?"day":"days"} ago`;const N={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return new Intl.DateTimeFormat("en-US",N).format(e)}catch(e){return console.error("Error formatting date:",e),"Date error"}},O=async(t=!1)=>{if(!(E.value||!t&&!$.value))try{E.value=!0;const e=G.params.postId,s=await ne.get("/auth/shared-post",{params:{status:"active",page:F.value,postId:e}});let r=[];if(Array.isArray(s.data)?r=s.data:s.data.data&&Array.isArray(s.data.data)&&(r=s.data.data),r.length===0){Y.notify({color:"warning",message:"Post not found",icon:"warning",position:"top-right"}),A.push("/community");return}const a=r.map(o=>({...o,wasLiked:o.wasLiked||o.liked||!1,liked:o.wasLiked||o.liked||!1}));t?v.value=[...v.value,...a]:v.value=a,ue.value=v.value.length,ce(),$.value=a.length===De.value,$.value&&F.value++}catch(e){console.error("Error loading posts:",e),Y.notify({color:"negative",message:"Failed to load post",icon:"error",position:"top-right"}),A.push("/community")}finally{E.value=!1,ee.value=!1}},ve=(t,e)=>{if(!t)return"";const s=t.split(" ");return s.length<=e?t:s.slice(0,e).join(" ")+"..."},me=t=>{const e=typeof t=="string"?t:t.toString();R.value[e]=!R.value[e]},ge=t=>{console.log("Tag clicked:",t)},fe=t=>{if(!t)return"";if(t.length===11)return`https://www.youtube.com/embed/${t}`;let e="";return t.includes("youtube.com/watch")?e=new URL(t).searchParams.get("v")||"":t.includes("youtu.be/")?e=t.split("youtu.be/")[1]:t.includes("youtube.com/embed/")&&(e=t.split("youtube.com/embed/")[1]),e=e.split("&")[0],`https://www.youtube.com/embed/${e}`},te=(t,e)=>`${fe(e)}?enablejsapi=1&rel=0&modestbranding=1&mute=1`,M=(t,e)=>{const s=document.getElementById(`video-${t}`);if(s&&s.contentWindow)try{s.contentWindow.postMessage(JSON.stringify({event:"command",func:e==="play"?"playVideo":"pauseVideo",args:[]}),"*")}catch(r){console.error("Error controlling video:",r)}},ye=t=>({handler:e=>{if(!e)return!1;try{const s=e.boundingClientRect,r=window.innerHeight,a=s.top+s.height/2,o=r/2,C=Math.abs(a-o)<100,N=e.isIntersecting;return Z.value[t]=N&&C,N&&C?(h.value!==null&&h.value!==t&&(M(h.value,"pause"),Z.value[h.value]=!1),M(t,"play"),h.value=t):h.value===t&&(M(t,"pause"),h.value=null),!0}catch(s){return console.error("Error in intersection handler:",s),!1}},cfg:{threshold:[0,.25,.5,.75,1],rootMargin:"-30% 0px"}});Ne(async()=>{await O()}),Be(()=>{h.value!==null&&M(h.value,"pause")});const p=c(null),he=c(0),j=(t,e)=>{const s=typeof t=="string"?parseInt(t,10):t;p.value=s.toString(),u.value=e;const r=v.value.find(a=>a.id===s);if(r&&r.mediaUrls){const a={postId:s,startIndex:e+1,totalImages:Array.isArray(r.mediaUrls)?r.mediaUrls.length:1,allImages:Array.isArray(r.mediaUrls)?r.mediaUrls.map((o,y)=>({index:y+1,url:b+o,isActive:y===e})):[{index:1,url:b+r.mediaUrls,isActive:!0}],activeDot:e};console.log("Carousel Opened:",a)}},pe=()=>{p.value=null,he.value=0,u.value=0},u=c(0),w=c(!1),k=B(()=>{const t=v.value.find(e=>e.id.toString()===p.value);return t?Array.isArray(t.mediaUrls)?t.mediaUrls.length:1:0}),se=B(()=>{const t=v.value.find(e=>e.id.toString()===p.value);return t!=null&&t.mediaUrls?{current:u.value+1,total:Array.isArray(t.mediaUrls)?t.mediaUrls.length:1}:{current:0,total:0}}),we=B(()=>f.value?f.value-1:u.value),_e=t=>{w.value||(w.value=!0,u.value=t,f.value=t+1,console.log("Go To Slide:",{index:t+1,total:k.value,currentVisible:f.value}),setTimeout(()=>{w.value=!1},300))},be=()=>{w.value||(w.value=!0,u.value=(u.value-1+k.value)%k.value,f.value=u.value+1,console.log("Previous Slide:",{newIndex:u.value+1,currentVisible:f.value}),setTimeout(()=>{w.value=!1},300))},ke=()=>{w.value||(w.value=!0,u.value=(u.value+1)%k.value,f.value=u.value+1,console.log("Next Slide:",{newIndex:u.value+1,currentVisible:f.value}),setTimeout(()=>{w.value=!1},300))},xe=B(()=>({transform:`translate3d(-${u.value*100}%, 0, 0)`,willChange:"transform"})),U=c(0),z=c(0),g=c(null),Ue=t=>{U.value=t.touches[0].clientX,g.value&&(g.value.style.transition="none")},Ce=t=>{if(!U.value||!g.value)return;const e=t.touches[0].clientX,s=U.value-e,r=-(u.value*100)-s/g.value.offsetWidth*100;g.value.style.transform=`translate3d(${r}%, 0, 0)`,z.value=e},Se=()=>{if(!U.value||!z.value||!g.value)return;g.value.style.transition="transform 0.3s ease-out";const t=U.value-z.value,e=g.value.offsetWidth*.2;Math.abs(t)>e?t>0&&u.value<k.value-1?ke():t<0&&u.value>0?be():g.value.style.transform=`translate3d(-${u.value*100}%, 0, 0)`:g.value.style.transform=`translate3d(-${u.value*100}%, 0, 0)`,U.value=0,z.value=0},f=c(null),Ie=c([]),Ae=t=>({handler:e=>{if(!e)return!1;if(e.isIntersecting){const s=v.value.find(a=>a.id.toString()===p.value),r={index:t+1,total:k.value,isIntersecting:e.isIntersecting,intersectionRatio:e.intersectionRatio,currentImage:s!=null&&s.mediaUrls?Array.isArray(s.mediaUrls)?s.mediaUrls[t]:s.mediaUrls:null,activeDot:u.value,postId:p.value};console.log("Image Data:",r),f.value=t+1}return!0},cfg:{threshold:[.5]}});W(u,t=>{const e=v.value.find(s=>s.id.toString()===p.value);console.log("Carousel State:",{currentIndex:t+1,totalImages:k.value,activeDot:t,currentImage:e!=null&&e.mediaUrls?Array.isArray(e.mediaUrls)?e.mediaUrls[t]:e.mediaUrls:null,postId:p.value})});const $e=async t=>{const e=v.value.findIndex(s=>s.id===t.id);e!==-1&&(v.value[e]={...t,wasLiked:t.wasLiked||t.liked,liked:t.wasLiked||t.liked},await qe())},F=c(1),De=c(5),$=c(!0),E=c(!1),D=c(null),Te=()=>{const t=new IntersectionObserver(async([e])=>{(e==null?void 0:e.isIntersecting)&&$.value&&!E.value&&await O(!0)},{rootMargin:"100px"});return D.value&&t.observe(D.value),()=>{D.value&&t.unobserve(D.value)}};W(()=>v.value,()=>{Pe(()=>{Te()})});const qe=async()=>{var t;try{const e=await ne.get(`/posts/user-interaction/${(t=V.user)==null?void 0:t.id}`);K.value=e.data}catch(e){console.error("Error updating interaction rules:",e)}};return W(()=>G.params.id,t=>{t&&(F.value=1,v.value=[],$.value=!0,O())}),(t,e)=>(n(),P(We,{class:"bg-grey-1",style:{"padding-top":"env(safe-area-inset-top)","padding-bottom":"env(safe-area-inset-bottom)"}},{default:m(()=>[Q(V).user.id?(n(),i("div",Ye,[d(X,{size:"sm",flat:"",class:"back-button",onClick:e[0]||(e[0]=s=>Q(A).go(-1))},{default:m(()=>e[5]||(e[5]=[l("i",{style:{"font-size":"14px"},class:"fa-solid fa-arrow-left-long"},null,-1)])),_:1})])):S("",!0),l("div",Ke,[e[9]||(e[9]=l("div",{class:"row items-center justify-between q-pa-md"},[l("div",null,[l("h4",{class:"text-h5 text-weight-bold q-my-none text-primary"}," Community Posts "),l("p",{class:"text-grey-7 q-mt-sm"}," Stay connected with your SOS Bharat community ")])],-1)),ee.value?(n(),i("div",Ze,[d(Qe,{color:"primary",size:"40"})])):v.value.length?(n(),i("div",st,[(n(!0),i(x,null,I(v.value,(s,r)=>(n(),i("div",{key:s.id,class:"col-12",ref_for:!0,ref:r===v.value.length-1?a=>{D.value=a}:void 0},[d(le,{flat:"",class:"post-card"},{default:m(()=>[d(T,{class:"q-pb-none"},{default:m(()=>[l("div",at,[d(Xe,{size:"48px",class:"shadow-2",onClick:a=>Q(A).push(`/my-posts/${s.userId}`)},{default:m(()=>e[7]||(e[7]=[l("img",{src:"/sos_logo_1080_1080.png",style:{"object-fit":"cover"}},null,-1)])),_:2},1032,["onClick"]),l("div",lt,[l("div",nt,_(s.userName=="SOS Bharat Community"?"SOS Bharat Community":s.userName),1),l("div",ot,[d(ae,{name:"schedule",size:"xs",class:"q-mr-xs"}),oe(" "+_(de(s.createdAt)),1)])])])]),_:2},1024),d(T,{style:{padding:"10px 10px 0px 10px"}},{default:m(()=>[l("div",it,_(s.title),1),l("div",rt,[oe(_(R.value[s.id.toString()]?s.description:ve(s.description,15))+" ",1),s.description.split(" ").length>10?(n(),i("span",{key:0,onClick:a=>me(s.id),class:"read-more-link"},_(R.value[s.id.toString()]?"Read Less":"Read More"),9,ut)):S("",!0)]),s.tags&&s.tags.length?(n(),i("div",ct,[(n(!0),i(x,null,I(s.tags,a=>(n(),i("span",{key:a,class:"hashtag",onClick:o=>ge(a)}," #"+_(a),9,dt))),128))])):S("",!0)]),_:2},1024),s.mediaUrls||s.videoUrl?(n(),P(T,{key:0,class:"q-pa-none q-mt-md"},{default:m(()=>[s.videoUrl?H((n(),i("div",vt,[(n(),i("iframe",{key:te(s.id.toString(),s.videoUrl),src:te(s.id.toString(),s.videoUrl),id:`video-${s.id}`,frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:"",class:"video-frame"},null,8,mt))])),[[ie,ye(s.id.toString())]]):s.mediaUrls&&s.mediaUrls.length?(n(),i("div",gt,[p.value===s.id.toString()?(n(),i(x,{key:0},[l("div",ft,[(n(!0),i(x,null,I(se.value.total,a=>(n(),i("button",{key:a,class:re(["dot",{active:we.value===a-1}]),onClick:J(o=>_e(a-1),["stop"])},null,10,yt))),128))]),l("div",ht,_(f.value)+" / "+_(se.value.total),1),l("button",{class:"carousel-close",onClick:J(pe,["stop"])},e[8]||(e[8]=[l("i",{class:"material-icons"},"close",-1)])),l("div",{class:"custom-carousel",ref_for:!0,ref_key:"carousel",ref:g,onTouchstart:Ue,onTouchmove:Ce,onTouchend:Se},[l("div",{class:"carousel-inner",style:He(xe.value)},[(n(!0),i(x,null,I(Array.isArray(s.mediaUrls)?s.mediaUrls.map(a=>b+a):[b+s.mediaUrls],(a,o)=>H((n(),i("div",{key:o,class:re(["carousel-slide",{active:u.value===o}]),ref_for:!0,ref_key:"carouselImages",ref:Ie},[d(q,{src:a,alt:`Image ${o+1}`,class:"carousel-image",onClick:e[1]||(e[1]=J(()=>{},["stop"])),fit:"contain"},null,8,["src","alt"])],2)),[[ie,Ae(o)]])),128))],4)],544)],64)):(n(),i("div",pt,[!Array.isArray(s.mediaUrls)||s.mediaUrls.length===1?(n(),P(q,{key:0,src:b+(Array.isArray(s.mediaUrls)?s.mediaUrls[0]:s.mediaUrls),class:"single-image",fit:"contain"},null,8,["src"])):s.mediaUrls.length===2?(n(),i("div",wt,[(n(!0),i(x,null,I(s.mediaUrls,(a,o)=>(n(),i("div",{key:o,class:"grid-image-container"},[d(q,{src:b+a,class:"grid-image",onClick:y=>j(s.id,o)},null,8,["src","onClick"])]))),128))])):(n(),i("div",_t,[l("div",bt,[d(q,{src:b+s.mediaUrls[0],class:"main-grid-image",onClick:a=>j(s.id,0)},null,8,["src","onClick"])]),l("div",kt,[(n(!0),i(x,null,I(s.mediaUrls.slice(1,3),(a,o)=>(n(),i("div",{key:o,class:"secondary-image-wrapper"},[d(q,{src:b+a,class:"secondary-grid-image",onClick:y=>j(s.id,o+1)},{default:m(()=>[o===1&&s.mediaUrls.length>3?(n(),i("div",xt,[l("span",Ut,"+"+_(s.mediaUrls.length-3),1)])):S("",!0)]),_:2},1032,["src","onClick"])]))),128))])]))]))])):S("",!0),d(Je,{post:s,userInteractionRules:K.value,"onUpdate:post":e[2]||(e[2]=a=>$e(a))},null,8,["post","userInteractionRules"])]),_:2},1024)):S("",!0)]),_:2},1024)]))),128))])):(n(),i("div",et,[l("div",tt,[d(ae,{name:"inbox",size:"48px",color:"grey-5"}),e[6]||(e[6]=l("p",{class:"text-grey-7 q-mt-sm"},"No posts available",-1))])]))]),d(Fe,{position:"bottom",modelValue:L.value,"onUpdate:modelValue":e[4]||(e[4]=s=>L.value=s),persistent:""},{default:m(()=>[d(le,{class:"dialof-bg",style:{"min-width":"350px","border-radius":"12px 12px 0 0"}},{default:m(()=>[e[14]||(e[14]=l("div",{class:"q-mb-none",style:{"justify-content":"center",display:"flex",padding:"0px !important"}},[l("img",{src:"/sos_logo_1080_1080.png",style:{width:"80px",height:"80px"}})],-1)),d(T,{class:"row items-center q-pb-none q-mt-none",style:{"padding-top":"0px !important"}},{default:m(()=>[e[10]||(e[10]=l("div",{class:"text-h6"},"Join Our SOS Bharat Community",-1)),d(Oe)]),_:1}),d(T,{class:"q-pt-xs"},{default:m(()=>e[11]||(e[11]=[l("p",{class:"text-body1"},"Create an account or login to:",-1),l("ul",{class:"q-mt-xs",style:{"margin-top":"-10px","margin-left":"-15px"}},[l("li",null,"Your safety is our top priority"),l("li",null,"View unlimited Posts / News"),l("li",null,"Interact with the community"),l("li",null,"Share your own stories"),l("li",null,"Engage with the community")],-1)])),_:1}),d(je,{align:"right",class:"q-pa-md flex",style:{"margin-top":"-10px"}},{default:m(()=>[H((n(),P(X,{class:"guest-btn",style:{width:"50%","border-radius":"40px"},flat:"",color:"grey-7"},{default:m(()=>e[12]||(e[12]=[l("span",{style:{"font-weight":"700","font-size":"14px"}}," Continue as Guest ",-1)])),_:1})),[[Ge]]),d(X,{style:{width:"45%","border-radius":"10px"},unelevated:"",color:"primary",onClick:e[3]||(e[3]=()=>{L.value=!1,Q(A).push("/login")})},{default:m(()=>e[13]||(e[13]=[l("span",{style:{"font-weight":"700","font-size":"14px"}}," Login / Sign Up ",-1)])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});var At=Ve(Ct,[["__scopeId","data-v-f4514afe"]]);export{At as default};
